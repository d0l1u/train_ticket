<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ctrip">
	<typeAlias alias="trainCtrip" type="com.l9e.transaction.vo.TrainCtrip" />
	<typeAlias alias="trainSeat" type="com.l9e.transaction.vo.TrainSeat" />
	<!-- 查询该车次信息的数据是否存在 -->
	<select id="queryCtripIsExist" parameterClass="trainCtrip" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM t_ctrip_cc1
		WHERE train_number=#train_number#
		<isNotEmpty prepend=" and " property="start_station_name">
			start_station_name=#start_station_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_station_name">
			end_station_name=#end_station_name:VARCHAR#
		</isNotEmpty>
	</select>

	<!-- 新增车次信息 -->
	<insert id="addCtrip" parameterClass="trainCtrip">
		insert into t_ctrip_cc1
		<dynamic prepend="(">
			create_time, update_time, 
			<isNotNull prepend="," property="train_number">
				train_number
			</isNotNull>
			<isNotNull prepend="," property="train_type">
				train_type
			</isNotNull>
			<isNotNull prepend="," property="start_station_name">
				start_station_name
			</isNotNull>
			<isNotNull prepend="," property="end_station_name">
				end_station_name
			</isNotNull>
			<isNotNull prepend="," property="strat_time">
				strat_time
			</isNotNull>
			<isNotNull prepend="," property="end_time">
				end_time
			</isNotNull>
			<isNotNull prepend="," property="take_time">
				take_time
			</isNotNull>
			<isNotNull prepend="," property="take_days">
				take_days
			</isNotNull>
			<isNotNull prepend="," property="pre_sale_day">
				pre_sale_day
			</isNotNull>
			<isNotNull prepend="," property="departure_city_name">
				departure_city_name
			</isNotNull>
			<isNotNull prepend="," property="arrival_city_name">
				arrival_city_name
			</isNotNull>
			<isNotNull prepend="," property="departure_date">
				departure_date
			</isNotNull>
			<isNotNull prepend="," property="dcity_code">
				dcity_code
			</isNotNull>
			<isNotNull prepend="," property="acity_code">
				acity_code
			</isNotNull>
			<isNotNull prepend="," property="dcity_id">
				dcity_id
			</isNotNull>
			<isNotNull prepend="," property="acity_id">
				acity_id
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			NOW(), NOW(),
			<isNotNull prepend="," property="train_number">
				#train_number:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="train_type">
				#train_type:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="start_station_name">
				#start_station_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="end_station_name">
				#end_station_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="strat_time">
				#strat_time:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="end_time">
				#end_time:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="take_time">
				#take_time:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="take_days">
				#take_days:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="pre_sale_day">
				#pre_sale_day:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="departure_city_name">
				#departure_city_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="arrival_city_name">
				#arrival_city_name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="departure_date">
				#departure_date:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dcity_code">
				#dcity_code:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="acity_code">
				#acity_code:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dcity_id">
				#dcity_id:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="acity_id">
				#acity_id:VARCHAR#
			</isNotNull>
			)
		</dynamic>
	</insert>

	<!-- 修改车次信息 -->
	<update id="updateCtrip" parameterClass="trainCtrip">
		UPDATE t_ctrip_cc1 SET update_time=now()
		<isNotEmpty prepend="," property="train_type">
			train_type=#train_type:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="start_station_name">
			start_station_name=#start_station_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="end_station_name">
			end_station_name=#end_station_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="strat_time">
			strat_time=#strat_time:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="end_time">
			end_time=#end_time:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="take_time">
			take_time=#take_time:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="take_days">
			take_days=#take_days:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="pre_sale_day">
			pre_sale_day=#pre_sale_day:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="departure_city_name">
			departure_city_name=#departure_city_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="arrival_city_name">
			arrival_city_name=#arrival_city_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="departure_date">
			departure_date=#departure_date:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="dcity_code">
			dcity_code=#dcity_code:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="acity_code">
			acity_code=#acity_code:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="dcity_id">
			dcity_id=#dcity_id:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="acity_id">
			acity_id=#acity_id:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="midway_status">
			midway_status=#midway_status:VARCHAR#
		</isNotEmpty>
		WHERE train_number=#train_number:VARCHAR#
	</update>
	
	<!-- 查询需要更新途经站的所有车次信息 -->
	<select id="queryTrainList" parameterClass="java.util.HashMap" resultClass="trainCtrip">
		SELECT id, train_number, train_type, start_station_name, end_station_name, strat_time, end_time, 
		take_time, take_days, pre_sale_day, departure_city_name, arrival_city_name, departure_date, 
		dcity_code, acity_code, dcity_id, acity_id, create_time, update_time, midway_status
		FROM t_ctrip_cc1
		WHERE 1=1 
		<isNotEmpty prepend=" and " property="midway_status">
			midway_status=#midway_status:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="departure_date">
			departure_date=#departure_date:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="train_number">
			train_number=#train_number:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="start_station_name">
			start_station_name=#start_station_name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="end_station_name">
			end_station_name=#end_station_name:VARCHAR#
		</isNotEmpty>
	</select>
	
	
	<!-- 查询该车次途经站信息的数据是否存在 -->
	<select id="queryMidWayIsExist" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM t_ctrip_sinfo1
		WHERE checi=#checi#
		<isNotEmpty prepend=" and " property="name">
			name=#name:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="stationno">
			stationno=#stationno:VARCHAR#
		</isNotEmpty>
	</select>

	<!-- 新增改车次的途经站信息 -->
	<insert id="addMidWay" parameterClass="java.util.HashMap">
		insert into t_ctrip_sinfo1
		<dynamic prepend="(">
			<isNotNull prepend="," property="stationno">
				stationno
			</isNotNull>
			<isNotNull prepend="," property="checi">
				checi
			</isNotNull>
			<isNotNull prepend="," property="name">
				name
			</isNotNull>
			<isNotNull prepend="," property="arrtime">
				arrtime
			</isNotNull>
			<isNotNull prepend="," property="starttime">
				starttime
			</isNotNull>
			<isNotNull prepend="," property="distance">
				distance
			</isNotNull>
			<isNotNull prepend="," property="costtime">
				costtime
			</isNotNull>
			<isNotNull prepend="," property="costday">
				costday
			</isNotNull>
			<isNotNull prepend="," property="czcc">
				czcc
			</isNotNull>
			<isNotNull prepend="," property="stopovertime">
				stopovertime
			</isNotNull>
			<isNotNull prepend="," property="station_code">
				station_code
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotNull prepend="," property="stationno">
				#stationno:INTEGER#
			</isNotNull>
			<isNotNull prepend="," property="checi">
				#checi:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="name">
				#name:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="arrtime">
				#arrtime:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="starttime">
				#starttime:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="distance">
				#distance:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="costtime">
				#costtime:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="costday">
				#costday:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="czcc">
				#czcc:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="stopovertime">
				#stopovertime:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="station_code">
				#station_code:VARCHAR#
			</isNotNull>
			)
		</dynamic>
	</insert>

	<!-- 修改车次信息 -->
	<update id="updateMidWay" parameterClass="java.util.HashMap">
		update t_ctrip_sinfo1
		<dynamic prepend="set">
			<isNotEmpty prepend="," property="stationno">
				 stationno=#stationno#
			</isNotEmpty>
			<isNotEmpty prepend="," property="checi">
				 checi=#checi#
			</isNotEmpty>
			<isNotEmpty prepend="," property="name">
				 name=#name#
			</isNotEmpty>
			<isNotEmpty prepend="," property="arrtime">
				 arrtime=#arrtime#
			</isNotEmpty>
			<isNotEmpty prepend="," property="starttime">
				 starttime=#starttime#
			</isNotEmpty>
			<isNotEmpty prepend="," property="distance">
				 distance=#distance#
			</isNotEmpty>
			<isNotEmpty prepend="," property="costtime">
				 costtime=#costtime#
			</isNotEmpty>
			<isNotEmpty prepend="," property="costday">
				 costday=#costday#
			</isNotEmpty>
			<isNotEmpty prepend="," property="czcc">
				 czcc=#czcc#
			</isNotEmpty>
			<isNotEmpty prepend="," property="stopovertime">
				 stopovertime=#stopovertime#
			</isNotEmpty>
			<isNotEmpty prepend="," property="station_code">
				 station_code=#station_code#
			</isNotEmpty>
		</dynamic>
		where checi=#checi# AND name=#name#
	</update>
	
	<!-- 查询所有的车站的信息始发站 -->
	<select id="queryZmStartList" resultClass="java.util.HashMap">
		SELECT id, name, pinyin, create_time
		FROM t_ctrip_zm1 WHERE id<![CDATA[>=]]>#size# and cc_status='00'
	</select>
	
	<!-- 根据id查询始发站 -->
	<select id="queryZmById" resultClass="java.util.HashMap">
		SELECT id, name, pinyin, create_time
		FROM t_ctrip_zm1 WHERE id<![CDATA[=]]>#id#  AND　cc_status　='00' 
	</select>
	
	<!-- 根据状态查询始发站 -->
	<select id="queryZmByCCStatus" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT id, name, pinyin, create_time
		FROM t_ctrip_zm1 WHERE cc_status=#cc_status:VARCHAR#  LIMIT  1
	</select>
	
	<!-- 查询所有的车站的信息到达站 -->
	<select id="queryZmArrivalList" resultClass="java.util.HashMap">
		SELECT id, name, pinyin, create_time
		FROM t_ctrip_zm1
	</select>
	
	<!-- 修改车站zm状态  -->
	<update id="updateZm" parameterClass="java.util.HashMap">
		update t_ctrip_zm1 set cc_status=#cc_status:VARCHAR#
		where id=#id:INTEGER#
	</update>
	
	<!-- 修改站名状态为中间状态 ,根据id-->
	<update id="updateZmCCStatus" parameterClass="java.lang.Integer">
		UPDATE t_ctrip_zm1 SET cc_status='01'
		WHERE id=#id:INTEGER# AND cc_status='00'
	</update>
	
	<!-- 查询该车次坐席票价信息的数据是否存在 -->
	<select id="querySeatIsExist" parameterClass="trainSeat" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM t_zjpj_a
		WHERE fz=#fz:VARCHAR# and dz=#dz:VARCHAR# and cc LIKE CONCAT('%', #cc#, '%')
	</select>

	<!-- 新增车次信息 -->
	<insert id="addSeat" parameterClass="trainSeat">
		insert into t_zjpj_a
		<dynamic prepend="(">
			xh,  update_time,
			<isNotNull prepend="," property="cc">
				cc
			</isNotNull>
			<isNotNull prepend="," property="fz">
				fz
			</isNotNull>
			<isNotNull prepend="," property="dz">
				dz
			</isNotNull>
			<isNotNull prepend="," property="wz">
				wz
			</isNotNull>
			<isNotNull prepend="," property="yz">
				yz
			</isNotNull>
			<isNotNull prepend="," property="rz">
				rz
			</isNotNull>
			<isNotNull prepend="," property="ywx">
				ywx
			</isNotNull>
			<isNotNull prepend="," property="rwx">
				rwx
			</isNotNull>
			<isNotNull prepend="," property="rz2">
				rz2
			</isNotNull>
			<isNotNull prepend="," property="rz1">
				rz1
			</isNotNull>
			<isNotNull prepend="," property="swz">
				swz
			</isNotNull>
			<isNotNull prepend="," property="tdz">
				tdz
			</isNotNull>
			<isNotNull prepend="," property="gwx">
				gwx
			</isNotNull>
			<isNotNull prepend="," property="dwx">
				dwx
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			#xh#, now(),
			<isNotNull prepend="," property="cc">
				#cc:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="fz">
				#fz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dz">
				#dz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="wz">
				#wz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="yz">
				#yz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="rz">
				#rz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="ywx">
				#ywx:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="rwx">
				#rwx:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="rz2">
				#rz2:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="rz1">
				#rz1:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="swz">
				#swz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="tdz">
				#tdz:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="gwx">
				#gwx:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dwx">
				#dwx:VARCHAR#
			</isNotNull>
			)
		</dynamic>
	</insert>

	<!-- 修改车次信息 -->
	<update id="updateSeat" parameterClass="trainSeat">
		UPDATE t_zjpj_a SET update_time=now()
		<isNotEmpty prepend="," property="fz">
			fz=#fz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="dz">
			dz=#dz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="wz">
			wz=#wz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="yz">
			yz=#yz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="rz">
			rz=#rz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="ywx">
			ywx=#ywx:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="rwx">
			rwx=#rwx:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="rz2">
			rz2=#rz2:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="rz1">
			rz1=#rz1:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="swz">
			swz=#swz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="tdz">
			tdz=#tdz:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="gwx">
			gwx=#gwx:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="," property="dwx">
			dwx=#dwx:VARCHAR#
		</isNotEmpty>
		WHERE fz=#fz:VARCHAR# and dz=#dz:VARCHAR# and cc LIKE CONCAT('%', #cc#, '%')
	</update>
</sqlMap> 