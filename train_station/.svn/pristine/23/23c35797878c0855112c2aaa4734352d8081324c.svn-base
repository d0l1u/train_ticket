<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="midway">
	<typeAlias alias="midway" type="com.l9e.transaction.vo.Midway" />

	<select id="queryMidwayFromSinfo" parameterClass="java.util.HashMap"
		resultClass="midway">
		SELECT stationno AS stationNo, checi AS trainCode, name AS stationName, starttime AS startTime,
		stopovertime AS stopoverTime, distance 
		FROM t_sinfo WHERE 1 = 1
		<isNotEmpty prepend=" and " property="trainCode">
			checi=#trainCode:VARCHAR#
		</isNotEmpty>
		<isNotNull prepend=" and " property="stationName">
			name=#stationName:VARCHAR#
		</isNotNull>
		<isNotEmpty prepend=" and " property="stationNo">
			stationno=#stationNo:VARCHAR#
		</isNotEmpty>
	</select>

	<select id="queryMidway" parameterClass="java.util.HashMap"
		resultClass="midway">
		select id, station_no as stationNo, train_code as trainCode,
		station_name as stationName,
		arrive_time as , start_time as
		startTime, stopover_time as
		stopoverTime, station_code as stationCode,
		distance from b_midway where 1 = 1
		<isNotEmpty prepend=" and " property="trainCode">
			train_code like
			concat("%", #trainCode:VARCHAR#, "%")
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="stationName">
			station_name=#stationName:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="stationNo">
			station_no=#stationNo:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend=" and " property="stationCode">
			station_code=#stationCode:VARCHAR#
		</isNotEmpty>
	</select>

	<insert id="insertMidway" parameterClass="java.util.List">
		insert into midway(train_code, station_name, arrive_time, start_time,
		station_no, stopover_time, station_code, distance)
		values
		<iterate conjunction="," property="midwayList">
		    <![CDATA[
		    (#midwayList[].trainCode#, #midwayList[].stationName#, #midwayList[].#, #midwayList[].startTime#, #midwayList[].stationNo#, #midwayList[].stopoverTime#, #midwayList[].stationCode#, #midwayList[].distance#)
		    ]]>
		</iterate>
	</insert>

	<insert id="insertMidwayIntot_sinfo" parameterClass="java.util.List">
		insert into t_sinfo(checi, name, arrtime, starttime, stationno,
		stopovertime, station_code, distance)
		values
		<iterate conjunction="," property="trainList">
		    <![CDATA[
		    (#trainList[].trainCode#,  #trainList[].stationName#,  #trainList[].arriveTime#, #trainList[].startTime#,  
		    #trainList[].stationNo#, #trainList[].stopoverTime#, #trainList[].stationCode#, #trainList[].distance#)
		    ]]>
		</iterate>
	</insert>
	
	<insert id="insertMidwayVoIntoSinfo" parameterClass="midway">
		INSERT INTO t_sinfo(checi, NAME, arrtime, starttime, stationno, stopovertime, station_code, distance, czcc)
		VALUES
		(#trainCode#,  #stationName#,  #arriveTime#, #startTime#, #stationNo#, #stopoverTime#, #stationCode#, #distance#, #trainCode#)
	</insert>

	<update id="updateMidway" parameterClass="midway">
		UPDATE midway SET start_time=#startTime:VARCHAR#,
		arrive_time=#arriveTime:VARCHAR#, station_no=#stationNo:INTEGER#,
		<isNotEmpty prepend="," property="distance">
			distance=#distance:INTEGER#
		</isNotEmpty>
		<isNotEmpty prepend=", " property="stationCode">
			station_code=#stationCode:VARCHAR#
		</isNotEmpty>
		WHERE 1 = 1 AND station_name=#stationName:VARCHAR# AND train_code like concat("%", #trainCode:VARCHAR#, "%")
	</update>

	<update id="updateMidwayOfTsinfo" parameterClass="midway">
		UPDATE t_sinfo SET starttime=#startTime:VARCHAR#,
		arrtime=#arriveTime:VARCHAR#, stationno=#stationNo#
		<isNotEmpty prepend="," property="distance">
			distance=#distance:INTEGER#
		</isNotEmpty>
		<isNotEmpty prepend="," property="trainCode">
			czcc=#trainCode:VARCHAR#
		</isNotEmpty>
		WHERE 1 = 1 AND name=#stationName:VARCHAR# AND checi like concat("%", #trainCode:VARCHAR#, "%")
	</update>


	<delete id="deleteMidway" parameterClass="java.util.HashMap">
		delete from b_midway where train_code like concat("%", #trainCode:VARCHAR#,
		"%")
	</delete>

	<delete id="deleteMidwayFromt_sinfo" parameterClass="java.util.HashMap">
		delete from t_sinfo where checi like concat("%", #trainCode:VARCHAR#, "%")
	</delete>
	
	
	<!-- 新增的操作 -->
	
	<delete id="deleteMidwayByCheci" parameterClass="java.util.HashMap">
		delete from t_sinfo where checi = #trainCode:VARCHAR#
	</delete>
	
	
	<insert id="insertMidwayBybach" parameterClass="java.util.List">
		<![CDATA[
		insert into t_sinfo(checi, name, arrtime, starttime, stationno,
		stopovertime, station_code, distance,costtime,costday,czcc) values 
		]]>
		<iterate  conjunction =",">
		    <![CDATA[
		    (#midwayList[].trainCode:VARCHAR#,  #midwayList[].stationName:VARCHAR#,  #midwayList[].arriveTime:VARCHAR#, #midwayList[].startTime:VARCHAR#,  
		    #midwayList[].stationNo:INTEGER#, #midwayList[].stopoverTime:VARCHAR#, #midwayList[].stationCode:VARCHAR#, #midwayList[].distance:VARCHAR#,
		    #midwayList[].costtime:VARCHAR#,#midwayList[].costday:VARCHAR#,#midwayList[].trainCode:VARCHAR#)
		    ]]>
		</iterate>
	</insert>
	
	
</sqlMap>
