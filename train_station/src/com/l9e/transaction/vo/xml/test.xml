<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" 
"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="test"> 

	<select id="queryFnList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		select * from ccs_nfdinfo nfd left join where nfd.air2c = #air2c:VARCHAR# 
	</select>
	
	<select id="queryAllList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		select * from ccs_allinfo zh where zh.air2c = #air2c:VARCHAR# 
	</select>
	
	
	<select id="queryAir2c" resultClass="java.util.HashMap">
		SELECT air2c FROM ccs_nfdinfo GROUP BY air2c
	</select>
	
	<select id="queryNfdAll" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT * FROM view_nfdfinal LIMIT #num:INTEGER# ,10000
	</select>
	
	<select id="queryFinalDep" resultClass="java.util.HashMap">
		SELECT dep FROM ccs_nfdfinal group by dep
	</select>
	
	<select id="queryFinalArr" resultClass="java.util.HashMap">
		SELECT arr FROM ccs_nfdfinal group by arr
	</select>
	
	<select id="queryFinalByDepArr" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT nfd.*,com.aircmpName FROM ccs_nfdfinal nfd LEFT JOIN ccs_aircompany com ON nfd.air2c=com.aircomp2c 
		WHERE dep=#dep:VARCHAR# and arr=#arr:VARCHAR# GROUP BY flno
	</select>
	
	<select id="queryList"  parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT nfdfinal.depCityName,depCity3c,nfdfinal.depName,dep,
		airtwo.cityName AS arrCityName,nfdfinal.arr AS arrCity3c,airtwo.airportName AS arrName,airtwo.airport3c AS arr,
		nfdfinal.air2c,nfdfinal.cabin,nfdfinal.flno,
		nfdfinal.price FROM
		(SELECT nfdone.nfdid,nfdone.dep,air.airportName AS depName,air.cityName AS depCityName,air.airport3c AS depCity3c
		,nfdone.arr,nfdone.air2c,nfdone.cabin,
		nfdone.price,nfdone.flno FROM
		(SELECT nfd.id AS nfdid,nfd.dep,nfd.arr,nfd.air2c,nfd.cabin,nfd.price,allinfo.flno FROM ccs_nfdinfo nfd 
		LEFT JOIN (SELECT * FROM ccs_allinfo zh WHERE zh.air2c = #air2c:VARCHAR#  GROUP BY zh.flno) AS allinfo
		ON nfd.dep = allinfo.dep AND nfd.arr = allinfo.arr AND nfd.air2c = allinfo.air2c  
		WHERE nfd.air2c = #air2c:VARCHAR#  AND nfd.price <![CDATA[<>]]>0 AND allinfo.id IS NOT NULL) AS nfdone LEFT JOIN ccs_airport air ON nfdone.dep = air.airport3c)AS nfdfinal
		LEFT JOIN  ccs_airport airtwo ON nfdfinal.arr = airtwo.airport3c
	</select>
	  
	  
	<insert id="addNfdFinal" parameterClass="java.util.HashMap">
		insert into ccs_nfdfinal
		<dynamic prepend="(">
			<isNotNull prepend="," property="depCityName">
				depCityName
			</isNotNull>
			<isNotNull prepend="," property="depCity3c">
				depCity3c
			</isNotNull>
			<isNotNull prepend="," property="depName">
				depName
			</isNotNull>
			<isNotNull prepend="," property="dep">
				dep
			</isNotNull>
			<isNotNull prepend="," property="arrCityName">
				arrCityName
			</isNotNull>
			<isNotNull prepend="," property="arrCity3c">
				arrCity3c
			</isNotNull>
			<isNotNull prepend="," property="arrName">
				arrName
			</isNotNull>
			<isNotNull prepend="," property="arr">
				arr
			</isNotNull>
			<isNotNull prepend="," property="air2c">
				air2c
			</isNotNull>
			<isNotNull prepend="," property="cabin">
				cabin
			</isNotNull>
			<isNotNull prepend="," property="flno">
				flno
			</isNotNull>
			<isNotNull prepend="," property="price">
				price
			</isNotNull> 
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotNull prepend="," property="depCityName">
				#depCityName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="depCity3c">
				#depCity3c:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="depName">
				#depName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="dep">
				#dep:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="arrCityName">
				#arrCityName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="arrCity3c">
				#arrCity3c:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="arrName">
				#arrName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="arr">
				#arr:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="air2c">
				#air2c:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="cabin">
				#cabin:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="flno">
				#flno:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="price">
				#price:VARCHAR#
			</isNotNull>  
			)
		</dynamic>
	</insert>
	
	
	
	<insert id="addMenu" parameterClass="java.util.HashMap">
		insert into ccs_menu
		<dynamic prepend="(">
			<isNotNull prepend="," property="level">
				level
			</isNotNull>
			<isNotNull prepend="," property="menuName">
				menuName
			</isNotNull>
			<isNotNull prepend="," property="identifiers">
				identifiers
			</isNotNull>
			<isNotNull prepend="," property="parentIdent">
				parentIdent
			</isNotNull>
			<isNotNull prepend="," property="chinesejp">
				chinesejp
			</isNotNull>
			<isNotNull prepend="," property="chineseqp">
				chineseqp
			</isNotNull>
			<isNotNull prepend="," property="englishjp">
				englishjp
			</isNotNull>
			<isNotNull prepend="," property="expandIdent">
				expandIdent
			</isNotNull>
			<isNotNull prepend="," property="menuBrief">
				menuBrief
			</isNotNull> 
			)
		</dynamic>
		values
		<dynamic prepend="(">
		<isNotNull prepend="," property="level">
				#level:INTEGER#
			</isNotNull>
			<isNotNull prepend="," property="menuName">
				#menuName:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="identifiers">
				#identifiers:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="parentIdent">
				#parentIdent:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="chinesejp">
				#chinesejp:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="chineseqp">
				#chineseqp:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="englishjp">
				#englishjp:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="expandIdent">
				#expandIdent:VARCHAR#
			</isNotNull>
			<isNotNull prepend="," property="menuBrief">
				#menuBrief:VARCHAR#
			</isNotNull> 
			)
		</dynamic>
	</insert>
	 
</sqlMap> 