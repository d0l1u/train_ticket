<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="order">
	<!-- 插如订单信息[] -->
	<insert id="addOrderInfo" parameterClass="com.l9e.transaction.vo.DBOrderInfo">
		insert into elong_orderinfo
		<dynamic prepend="(">
			<isNotEmpty  property="order_id">
				order_id,
			</isNotEmpty>
			<isNotEmpty  property="order_status">
				order_status,
			</isNotEmpty>
			<isNotEmpty  property="order_name">
				order_name,
			</isNotEmpty>
			<isNotEmpty  property="pay_money">
				pay_money,
			</isNotEmpty>
			<isNotEmpty  property="train_no">
				train_no,
			</isNotEmpty>
			<isNotEmpty  property="from_city">
				from_city,
			</isNotEmpty>
			<isNotEmpty  property="to_city">
				to_city,
			</isNotEmpty>
			<isNotEmpty  property="from_time">
				from_time,
			</isNotEmpty>
			<isNotEmpty  property="to_time">
				to_time,
			</isNotEmpty>
			<isNotEmpty  property="seat_type">
				seat_type,
			</isNotEmpty>
			<isNotEmpty  property="elong_seat_type">
				elong_seat_type,
			</isNotEmpty>
			<isNotEmpty  property="order_time">
				order_time,
			</isNotEmpty>
			<isNotEmpty  property="ext_field1">
				ext_field1,
			</isNotEmpty>
			<isNotEmpty  property="ext_field2">
				ext_field2,
			</isNotEmpty>
			<isNotEmpty  property="ticket_num">
				ticket_num,
			</isNotEmpty>
			<isNotEmpty  property="channel">
				channel,
			</isNotEmpty>
			<isNotEmpty  property="travel_date">
				travel_date,
			</isNotEmpty>
			<isNotEmpty  property="wait_for_order">
				wait_for_order,
			</isNotEmpty>
			create_time
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotEmpty property="order_id">
				#order_id:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="order_status">
				#order_status:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="order_name">
				#order_name:DECIMAL#,
			</isNotEmpty>
			<isNotEmpty property="pay_money">
				#pay_money:DECIMAL#,
			</isNotEmpty>
			<isNotEmpty property="train_no">
				#train_no:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="from_city">
				#from_city:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="to_city">
				#to_city:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="from_time">
				#from_time:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="to_time">
				#to_time:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="seat_type">
				#seat_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="elong_seat_type">
				#elong_seat_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="order_time">
				#order_time:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="ext_field1">
				#ext_field1:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="ext_field2">
				#ext_field2:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="ticket_num">
				#ticket_num:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="channel">
				#channel:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="travel_date">
				#travel_date:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="wait_for_order">
				#wait_for_order:VARCHAR#,
			</isNotEmpty>
			NOW()
			)
		</dynamic>
	</insert>
	<!-- 插入车票信息[] -->
	<insert id="addPassengerInfo" parameterClass="com.l9e.transaction.vo.DBPassengerInfo">
		insert into elong_orderinfo_cp
		<dynamic prepend="(">
			<isNotEmpty  property="order_id">
				order_id,
			</isNotEmpty>
			<isNotEmpty  property="user_name">
				user_name,
			</isNotEmpty>
			<isNotEmpty  property="ticket_type">
				ticket_type,
			</isNotEmpty>
			<isNotEmpty  property="elong_ticket_type">
				elong_ticket_type,
			</isNotEmpty>
			<isNotEmpty  property="ids_type">
				ids_type,
			</isNotEmpty>
			<isNotEmpty  property="elong_ids_type">
				elong_ids_type,
			</isNotEmpty>
			<isNotEmpty  property="user_ids">
				user_ids,
			</isNotEmpty>
			<isNotEmpty  property="telephone">
				telephone,
			</isNotEmpty>
			<isNotEmpty  property="pay_money">
				pay_money,
			</isNotEmpty>
			<isNotEmpty  property="seat_type">
				seat_type,
			</isNotEmpty>
			<isNotEmpty  property="elong_seat_type">
				elong_seat_type,
			</isNotEmpty>
			<isNotEmpty  property="out_passengerid">
				out_passengerid,
			</isNotEmpty>
			cp_id,
			create_time
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotEmpty  property="order_id">
				#order_id:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="user_name">
				#user_name:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="ticket_type">
				#ticket_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="elong_ticket_type">
				#elong_ticket_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="ids_type">
				#ids_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="elong_ids_type">
				#elong_ids_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="user_ids">
				#user_ids:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="telephone">
				#telephone:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="pay_money">
				#pay_money:DECIMAL#,
			</isNotEmpty>
			<isNotEmpty  property="seat_type">
				#seat_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="elong_seat_type">
				#elong_seat_type:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="out_passengerid">
				#out_passengerid:VARCHAR#,
			</isNotEmpty>
			#cp_id:VARCHAR#,
			NOW()
			)
		</dynamic>
	</insert>
	
	<!-- 插入学生票 特殊信息[] -->
	<insert id="addStudentInfo" parameterClass="com.l9e.transaction.vo.DBStudentInfo">
		insert into cp_orderinfo_student
		<dynamic prepend="(">
			<isNotEmpty  property="province_name">
				province_name,
			</isNotEmpty>
			<isNotEmpty  property="province_code">
				province_code,
			</isNotEmpty>
			<isNotEmpty  property="school_code">
				school_code,
			</isNotEmpty>
			<isNotEmpty  property="school_name">
				school_name,
			</isNotEmpty>
			<isNotEmpty  property="student_no">
				student_no,
			</isNotEmpty>
			<isNotEmpty  property="school_system">
				school_system,
			</isNotEmpty>
			<isNotEmpty  property="enter_year">
				enter_year,
			</isNotEmpty>
			<isNotEmpty  property="preference_from_station_name">
				preference_from_station_name,
			</isNotEmpty>
			<isNotEmpty  property="preference_from_station_code">
				preference_from_station_code,
			</isNotEmpty>
			<isNotEmpty  property="preference_to_station_name">
				preference_to_station_name,
			</isNotEmpty>
			<isNotEmpty  property="preference_to_station_code">
				preference_to_station_code,
			</isNotEmpty>
			<isNotEmpty  property="channel">
				channel,
			</isNotEmpty>
			cp_id,
			order_id
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotEmpty  property="province_name">
				#province_name:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="province_code">
				#province_code:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="school_code">
				#school_code:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="school_name">
				#school_name:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="student_no">
				#student_no:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="school_system">
				#school_system:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty  property="enter_year">
				#enter_year:DECIMAL#,
			</isNotEmpty>
			<isNotEmpty  property="preference_from_station_name">
				#preference_from_station_name:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="preference_from_station_code">
				#preference_from_station_code:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="preference_to_station_name">
				#preference_to_station_name:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="preference_to_station_code">
				#preference_to_station_code:VARCHAR#,
			</isNotEmpty>
			<isNotEmpty property="channel">
				#channel:VARCHAR#,
			</isNotEmpty>
				#cp_id:VARCHAR#,
				#order_id:VARCHAR#
			)
		</dynamic>
	</insert>
	
	
	<update id="updateOrderStatus" parameterClass="java.util.HashMap">
		update elong_orderinfo set order_status= #order_status:VARCHAR#
		where order_id =#order_id:VARCHAR#
		and order_status in
		<dynamic prepend="(">
			<isNotEmpty property="old_order_status1">
				#old_order_status1:VARCHAR#
			</isNotEmpty>
			<isNotEmpty property="old_order_status2">
				,#old_order_status2:VARCHAR#
			</isNotEmpty>
			<isNotEmpty  property="old_order_status3">
				,#old_order_status3:VARCHAR#
			</isNotEmpty>
			)
			</dynamic>
	</update>
	
	<select id="queryOutTicketOrderInfo" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		select * from cp_orderinfo where order_id=#order_id:VARCHAR#
	</select>
	
	
	<select id="queryOrderStatusByOrderId" parameterClass="java.lang.String" resultClass="java.lang.String">
		select order_status from elong_orderinfo where order_id=#order_id:VARCHAR#
	</select>
	
	
	<select id="queryOutTicketOrderStatusByOrderId" parameterClass="java.lang.String" resultClass="java.lang.String">
		select order_status from cp_orderinfo where order_id=#order_id:VARCHAR#
	</select>
	
	
	<select id="queryOrderInfo" parameterClass="java.lang.String" resultClass="com.l9e.transaction.vo.DBOrderInfo">
		select * from elong_orderinfo where order_id=#order_id:VARCHAR#
	</select>
	
	
	<select id="queryOrderCpsInfo" parameterClass="java.lang.String" resultClass="com.l9e.transaction.vo.DBPassengerInfo">
		select * from elong_orderinfo_cp where order_id=#order_id:VARCHAR#
	</select>
	
	<!-- 更新cp 车票信息表 -->
	<update id="updateCpOrderInfo" parameterClass="java.util.Map">
		update elong_orderinfo_cp set
		<isNotEmpty property="buy_money">
				buy_money=#buy_money:VARCHAR#,
		</isNotEmpty>
		<isNotEmpty property="train_box">
				train_box=#train_box:VARCHAR#,
		</isNotEmpty>
		<isNotEmpty property="seat_no">
				seat_no=#seat_no:VARCHAR#,
		</isNotEmpty>
		<isNotEmpty property="seat_type">
				seat_type=#seat_type:VARCHAR#,
		</isNotEmpty>
		<isNotEmpty property="elong_seat_type">
				elong_seat_type=#elong_seat_type:VARCHAR#,
		</isNotEmpty>
		<isNotEmpty property="out_ticket_billno">
				out_ticket_billno=#out_ticket_billno:VARCHAR#,
		</isNotEmpty>
		modify_time=now()
		where order_id=#order_id:VARCHAR# and cp_id=#cp_id:VARCHAR#
	</update>
	
	<!-- 更新elong订单表订单信息 -->
	<update id="updateOrderInfo" parameterClass="com.l9e.transaction.vo.DBOrderInfo">
		update  elong_orderinfo set
			<dynamic >
				<isNotEmpty property="buy_money">
				buy_money=#buy_money:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="out_ticket_time">
				out_ticket_time=#out_ticket_time:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="out_ticket_billno">
				out_ticket_billno=#out_ticket_billno:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="out_fail_reason">
				out_fail_reason=#out_fail_reason:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="passenger_reason">
				passenger_reason=#passenger_reason:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="from_time">
				from_time=#from_time:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="to_time">
				to_time=#to_time:VARCHAR#,
				</isNotEmpty>
				<isNotEmpty property="pay_limit_time">
				pay_limit_time=#pay_limit_time:VARCHAR#,
				</isNotEmpty>
			</dynamic>
			order_status=#order_status:VARCHAR#
			where order_id=#order_id:VARCHAR#
	</update>
	
	<!-- 查询退款状态 -->
	<select id="queryRefundStatus" parameterClass="java.util.Map" resultClass="java.lang.String">
		select refund_status from elong_orderinfo_refundstream where order_id=#order_id:VARCHAR# and cp_id=#cp_id:VARCHAR#
		and refund_type=#refund_type:VARCHAR#
		order by create_time desc limit 0,1
	</select>
	
	
	<insert id="insertRefundOrder" parameterClass="java.util.HashMap">
		insert into elong_orderinfo_refundstream 
			<dynamic prepend="(">
			order_id,cp_id,refund_seq,create_time,channel
			<isNotNull  property="refund_type">
				,refund_type
			</isNotNull>
			<isNotNull  property="refund_money">
				,refund_money
			</isNotNull>
			<isNotNull  property="refund_status">
				,refund_status
			</isNotNull>
			<isNotNull  property="reqtoken">
				,reqtoken
			</isNotNull>
			<isNotNull  property="callbackurl">
				,callbackurl
			</isNotNull>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			#order_id:VARCHAR#,#cp_id:VARCHAR#,#refund_seq:VARCHAR#,now(),#channel:VARCHAR#
				<isNotNull  property="refund_type">
				,#refund_type:VARCHAR#
				</isNotNull>
				<isNotNull  property="refund_money">
				,#refund_money:VARCHAR#
				</isNotNull>
				<isNotNull  property="refund_status">
				,#refund_status:VARCHAR#
				</isNotNull>
				<isNotNull  property="reqtoken">
				,#reqtoken:VARCHAR#
			</isNotNull>
			<isNotNull  property="callbackurl">
				,#callbackurl:VARCHAR#
			</isNotNull> 
				)
		</dynamic>
	</insert>
	
	
	<select id="queryOutTicketCpInfo" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		select * from cp_orderinfo_cp where cp_id=#cp_id:VARCHAR#
	</select>
	
	
	<update id="updateOrderNoticeStatus" parameterClass="java.util.Map">
	update elong_orderinfo set notice_status=#notice_status:VARCHAR#
			where order_id=#order_id:VARCHAR# AND (notice_status='00' OR notice_status='11' OR notice_status='33' or notice_status is null)
	</update>
	
	
	<select id="queryAllChannelNotify" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		select * from elong_allchannel_notify where order_id=#order_id:VARCHAR#
	</select>
	
	<update id="updateOrderPayMoney" parameterClass="java.util.Map">
		update elong_orderinfo set pay_money=#pay_money:VARCHAR#
			where order_id=#order_id:VARCHAR# 
	</update>
	
	
	<select id="querySeatNo" parameterClass="java.util.Map" resultClass="java.lang.String">
		select seat_no from elong_orderinfo_cp where  cp_id=#cp_id:VARCHAR#
	</select>
	
	
	<select id="queryChangeIdsByOrderId" parameterClass="java.lang.String" resultClass="java.lang.String">
		select change_id from elong_orderinfo_change where order_id=#order_id:VARCHAR#
	</select>
	
	<select id="selectAccountById" parameterClass="Int" resultClass="java.util.HashMap">
		SELECT
			acc_username username,
			acc_status status,
			stop_reason stop
		FROM
			cp_accountinfo
		WHERE
			acc_id = #id:INTEGER#
	</select>
	
	<!-- 查询订单中出发与到达车站的三字码 -->
	<select id="queryCity3CList" parameterClass="java.util.Map" resultClass="com.l9e.transaction.vo.DBOrderInfo">
		select c.zmhz AS stationName,c.lh AS stationCode
		from t_zm AS c 
		where c.zmhz = #from_city:VARCHAR# or c.zmhz = #to_city:VARCHAR# 
	</select>
	
</sqlMap>