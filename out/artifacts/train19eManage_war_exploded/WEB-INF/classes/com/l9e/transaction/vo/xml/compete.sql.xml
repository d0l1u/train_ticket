<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="compete">

	<!--查询 -->
	<select id="queryCompeteList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
			    compete_id,
			    DATE_FORMAT(compete_date,'%Y-%m-%d') AS compete_date,
				compete_time,
				compete_channel,
				compete_goods_1,
				compete_goods_2,
				compete_money_1,
				compete_money_2,
				compete_money_un_1,
				compete_money_un_2,
				compete_ranking_1,
				compete_ranking_2,
				compete_ranking_un_1,
				compete_ranking_un_2,
				compete_top,
				compete_top_un,
				DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') AS create_time,
				count_1,
				count_2,
				opt_ren 
			FROM
			  train_compete 
			WHERE 1=1
			<dynamic prepend="">
				<isNotEmpty prepend=" and " property="opt_ren">
					opt_ren=#opt_ren#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="compete_channel">
					compete_channel in
					<iterate open="(" close=")" conjunction=","
						property="compete_channel">
						#compete_channel[]:VARCHAR#
					</iterate>
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="begin_info_time">
					create_time<![CDATA[>=]]>DATE_FORMAT(#begin_info_time#,'%Y-%m-%d %H:%i:%s')
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="end_info_time">
					create_time<![CDATA[<]]>DATE_ADD(DATE_FORMAT(#end_info_time#,'%Y-%m-%d %H:%i:%s'),INTERVAL 1 DAY)
			</isNotEmpty>
			</dynamic>
		order by create_time desc  LIMIT #everyPagefrom:Integer#,#pageSize:Integer#
	</select>
	

	<!-- 总数 -->
	<select id="queryCompeteCounts" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM train_compete where 1=1 
		<dynamic prepend="">
				<isNotEmpty prepend=" and " property="opt_ren">
					opt_ren=#opt_ren#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="compete_channel">
					compete_channel in
					<iterate open="(" close=")" conjunction=","
						property="compete_channel">
						#compete_channel[]:VARCHAR#
					</iterate>
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="begin_info_time">
					create_time<![CDATA[>=]]>DATE_FORMAT(#begin_info_time#,'%Y-%m-%d %H:%i:%s')
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="end_info_time">
					create_time<![CDATA[<]]>DATE_ADD(DATE_FORMAT(#end_info_time#,'%Y-%m-%d %H:%i:%s'),INTERVAL 1 DAY)
			</isNotEmpty>
			</dynamic>
	</select>

	<!-- 明细 -->
	<select id="queryCompeteInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
			    compete_id,
			    DATE_FORMAT(compete_date,'%Y-%m-%d') AS compete_date,
				compete_time,
				compete_channel,
				compete_goods_1,
				compete_goods_2,
				compete_money_1,
				compete_money_2,
				compete_money_un_1,
				compete_money_un_2,
				compete_ranking_1,
				compete_ranking_2,
				compete_ranking_un_1,
				compete_ranking_un_2,
				compete_top,
				compete_top_un,
				DATE_FORMAT(create_time,'%Y-%m-%d %H:%i') AS create_time,
				count_1,
				count_2,
				opt_ren 
			FROM
			  train_compete 
			WHERE compete_id=#compete_id#
	</select>
	
	<!-- 增加 -->
	<insert id="addCompete" parameterClass="java.util.HashMap">
		INSERT INTO train_compete 
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="compete_date">
				 compete_date
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_time">
				 compete_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_channel">
				 compete_channel
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_goods_1">
				 compete_goods_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_1">
				 compete_money_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_1">
				 compete_money_un_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_1">
				 compete_ranking_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_un_1">
				 compete_ranking_un_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_top">
				 compete_top
			</isNotEmpty>
				<isNotEmpty prepend="," property="compete_goods_2">
				 compete_goods_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_2">
				 compete_money_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_2">
				 compete_money_un_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_2">
				 compete_ranking_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_un_2">
				 compete_ranking_un_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_top_un">
				 compete_top_un
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				 create_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				 opt_ren
			</isNotEmpty>
			<isNotEmpty prepend="," property="count_1">
				 count_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="count_2">
				 count_2
			</isNotEmpty>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="compete_date">
				 now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_time">
				#compete_time#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_channel">
				 #compete_channel#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_goods_1">
				 #compete_goods_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_1">
				 #compete_money_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_1">
				 #compete_money_un_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_1">
				 #compete_ranking_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_un_1">
				 #compete_ranking_un_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_top">
				 #compete_top#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_goods_2">
				 #compete_goods_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_2">
				 #compete_money_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_2">
				 #compete_money_un_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_2">
				 #compete_ranking_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_un_2">
				 #compete_ranking_un_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_top_un">
				 #compete_top_un#
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				 now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				 #opt_ren#
			</isNotEmpty>
			<isNotEmpty prepend="," property="count_1">
				 #count_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="count_2">
				 #count_2#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 修改 -->
	<update id="updateCompete" parameterClass="java.util.HashMap">
		UPDATE train_compete
		<dynamic prepend="SET">
			<isNotEmpty prepend="," property="compete_date">
				compete_date= #compete_date#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_time">
				compete_time=#compete_time#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_channel">
				compete_channel= #compete_channel#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_goods">
				compete_goods= #compete_goods#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money">
				compete_money=#compete_money#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un">
				compete_money_un= #compete_money_un#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_20bx">
				compete_20bx= #compete_20bx#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_5bx">
				compete_5bx= #compete_5bx#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking">
				compete_ranking= #compete_ranking#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_ranking_un">
				compete_ranking_un= #compete_ranking_un#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_top">
				compete_top= #compete_top#
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				 create_time=now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				 opt_ren=#opt_ren#
			</isNotEmpty>
			<isNotEmpty prepend="," property="count_1">
				 count_1=#count_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="count_2">
				 count_2=#count_2#
			</isNotEmpty>
		</dynamic>
			WHERE  compete_id=#compete_id#
	</update>

	<!-- 导出queryCompeteExcel -->
	<select id="queryCompeteExcel" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
			    compete_id,
			    DATE_FORMAT(compete_date,'%Y-%m-%d') AS compete_date,
				compete_time,
				compete_channel,
				compete_goods_1,
				compete_goods_2,
				compete_money_1,
				compete_money_2,
				compete_money_un_1,
				compete_money_un_2,
				compete_ranking_1,
				compete_ranking_2,
				compete_ranking_un_1,
				compete_ranking_un_2,
				compete_top,
				compete_top_un,
				DATE_FORMAT(create_time,'%Y-%m-%d %H:%i') AS create_time,
				count_1,
				count_2,
				opt_ren 
			FROM
			  train_compete 
			WHERE 1=1
			<dynamic prepend="">
				<isNotEmpty prepend=" and " property="opt_ren">
					opt_ren=#opt_ren#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="compete_channel">
					compete_channel in
					<iterate open="(" close=")" conjunction=","
						property="compete_channel">
						#compete_channel[]:VARCHAR#
					</iterate>
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="begin_info_time">
					create_time<![CDATA[>=]]>DATE_FORMAT(#begin_info_time#,'%Y-%m-%d %H:%i:%s')
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="end_info_time">
					create_time<![CDATA[<]]>DATE_ADD(DATE_FORMAT(#end_info_time#,'%Y-%m-%d %H:%i:%s'),INTERVAL 1 DAY)
			</isNotEmpty>
			</dynamic>
			order by create_time  
	</select>
	
	
	<!--查询 -->
	<select id="queryCompeteListJob" resultClass="java.util.HashMap">
		SELECT 
		  compete_id,
		  DATE_FORMAT(compete_date, '%Y-%m-%d') AS compete_date,
		  compete_time,
		  compete_channel,
		  compete_goods_1,
		  compete_goods_2,
		  compete_money_1,
		  compete_money_2,
		  compete_money_un_1,
		  compete_money_un_2,
		  compete_ranking_1,
		  compete_ranking_2,
		  compete_ranking_un_1,
		  compete_ranking_un_2,
		  compete_top,
		  compete_top_un,
		  DATE_FORMAT(create_time, '%Y-%m-%d') AS create_time,
		  count_1,
		  count_2,
		  opt_ren 
		FROM
		  train_compete 
		WHERE 1=1 
			and	count_1 IS NULL  
			and	count_2 IS NULL
	</select>
	
	<!-- 查询票数 -->
	<select id="qunar_ticket_count" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
	SELECT COUNT(1)FROM qunar_orderinfo_cp cp LEFT JOIN qunar_orderinfo hc ON cp.order_id=hc.order_id 
		WHERE  hc.order_status='44'		
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="order_source">
				hc.order_source=#order_source#
			</isNotEmpty>
		</dynamic>
		</select>
	<!-- 查询修改下个小时竞价明细 -->
	<select id="queryCompeteHistory" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
		  log_id,content,DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') AS create_time,opt_person,compete_money_1,  compete_money_un_1,
		  compete_money_2,compete_money_un_2 
		FROM
		  train_compete_log
		ORDER BY create_time DESC 
	    LIMIT #everyPagefrom:Integer#,#pageSize:Integer#
	</select>
	<!-- 总数 -->
	<select id="queryCompeteHistoryCounts" resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM train_compete_log 
	</select>
	<!-- 查询当前竞价 -->
	<select id="querynow_compete" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
			    compete_id,
			    DATE_FORMAT(compete_date,'%Y-%m-%d') AS compete_date,
				compete_time,
				compete_channel,
				compete_goods_1,
				compete_goods_2,
				compete_money_1,
				compete_money_2,
				compete_money_un_1,
				compete_money_un_2,
				compete_ranking_1,
				compete_ranking_2,
				compete_ranking_un_1,
				compete_ranking_un_2,
				compete_top,
				compete_top_un,
				DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') AS create_time,
				count_1,
				count_2,
				opt_ren 
			FROM
			  train_compete 
			WHERE 1=1
			<dynamic prepend="">
				<isNotEmpty prepend=" and " property="compete_date">
					compete_date=#compete_date#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="compete_time">
					compete_time=#compete_time#
				</isNotEmpty>
			</dynamic>
			ORDER BY create_time DESC
	</select>	
	
		<!-- 增加 -->
	<insert id="addhistory" parameterClass="java.util.HashMap">
		INSERT INTO train_compete_log 
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="compete_money_1">
				 compete_money_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_1">
				 compete_money_un_1
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_2">
				 compete_money_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_2">
				 compete_money_un_2
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				 create_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="content">
				 content
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_person">
				 opt_person
			</isNotEmpty>
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="compete_money_1">
				 #compete_money_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_1">
				 #compete_money_un_1#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_2">
				 #compete_money_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="compete_money_un_2">
				 #compete_money_un_2#
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				 now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="content">
				 #content#
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_person">
				 #opt_person#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
</sqlMap>