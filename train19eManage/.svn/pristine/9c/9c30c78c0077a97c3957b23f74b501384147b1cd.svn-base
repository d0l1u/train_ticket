<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ctripAccount">

	<!-- 查询 -->
	<select id="queryCtripAccountList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT 
		  acc.ctrip_id,
		  acc.ctrip_name,
		  acc.ctrip_password,
		  acc.ctrip_status,
		  acc.pay_password,
		  acc.ctrip_username,
		  acc.ctrip_phone,
		  acc.create_time,
		  acc.opt_person,
		  acc.balance,
		  acc_degree,
		  acc.option_time,
		  acc.result_type,
		  card.ctrip_card_no,
		  mail.mail_account,
		  mail.mail_pwd
		FROM
		  ctrip_accountinfo acc  left join ctrip_cardinfo card on 
		  acc.card_id=card.card_id left join ctrip_mailinfo mail on acc.mail_id = mail.id
		  WHERE 1=1 
		  <dynamic prepend="">
		   <isNotEmpty prepend=" and " property="ctrip_name">
		         acc.ctrip_name=#ctrip_name#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="ctrip_username">
	              acc.ctrip_username=#ctrip_username#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="ctrip_phone">
	              acc.ctrip_phone=#ctrip_phone#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="begin_info_time">
	              acc.create_time<![CDATA[>]]>CONCAT(#begin_info_time#,' 00:00:00')
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="end_info_time">
	    		  acc.create_time<![CDATA[<]]>CONCAT(#end_info_time#,' 23:59:59')
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="ctrip_statusList">
	         	  acc.ctrip_status in
		          <iterate open="(" close=")" conjunction="," property="ctrip_statusList">
		            	#ctrip_statusList[]:VARCHAR#
		      	  </iterate>
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="beginBalance">
		    	acc.balance >= #beginBalance#
		   </isNotEmpty>
		   <isNotEmpty prepend=" and " property="endBalance">
		    	#endBalance# >= acc.balance 
		   </isNotEmpty>
		   <isNotEmpty prepend=" and " property="acc_degree">
		    	acc.acc_degree = #acc_degree#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="result_type">
		    	result_type <![CDATA[<>]]> 0 and result_type <![CDATA[<>]]> 9 
		   </isNotEmpty> 
		  </dynamic>
		  ORDER BY acc.option_time DESC
		  LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>

	<!-- 查询总数-->
	<select id="queryCtripAccountListCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT 
			 COUNT(1)
			FROM
			  ctrip_accountinfo WHERE 1=1 
		  <dynamic prepend="">
		   <isNotEmpty prepend=" and " property="ctrip_name">
		              ctrip_name=#ctrip_name#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="ctrip_username">
		              ctrip_username=#ctrip_username#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="ctrip_phone">
		              ctrip_phone=#ctrip_phone#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="begin_info_time">
		              create_time<![CDATA[>]]>CONCAT(#begin_info_time#,' 00:00:00')
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="end_info_time">
		    		  create_time<![CDATA[<]]>CONCAT(#end_info_time#,' 23:59:59')
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="ctrip_statusList">
		         	  ctrip_status in
			          <iterate open="(" close=")" conjunction="," property="ctrip_statusList">
			            	#ctrip_statusList[]:VARCHAR#
			      	  </iterate>
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="beginBalance">
		    	balance >= #beginBalance#
		   </isNotEmpty>
		   <isNotEmpty prepend=" and " property="endBalance">
		    	#endBalance# >= balance 
		   </isNotEmpty>
		   <isNotEmpty prepend=" and " property="acc_degree">
		    	acc_degree = #acc_degree#
		   </isNotEmpty>
		    <isNotEmpty prepend=" and " property="result_type">
		    	result_type <![CDATA[<>]]> 0 and result_type <![CDATA[<>]]> 9
		   </isNotEmpty> 
		  </dynamic>
	</select>

	<!-- 查询明细-->
	<select id="queryCtripAccount" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT 
			  ctrip_id,
			  ctrip_name,
			  ctrip_password,
			  ctrip_status,
			  pay_password,
			  ctrip_username,
			  ctrip_phone,
			  create_time,
			  opt_person,
			  option_time,
			  cookie,
			  cid,
			  auth,
			  sauth
			FROM
			  ctrip_accountinfo  WHERE ctrip_id=#ctrip_id#
	</select>

	<!-- 插入账号信息 -->
	<insert id="insertCtripAccount" parameterClass="java.util.HashMap">
		insert into ctrip_accountinfo
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="ctrip_name">
				 ctrip_name
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_password">
				ctrip_password
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_username">
				ctrip_username
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_phone">
				ctrip_phone
			</isNotEmpty>
			<isNotEmpty prepend="," property="cookie">
				cookie
			</isNotEmpty>
			<isNotEmpty prepend="," property="cid">
				cid 
			</isNotEmpty>
			<isNotEmpty prepend="," property="auth">
				auth 
			</isNotEmpty>
			<isNotEmpty prepend="," property="sauth">
				sauth 
			</isNotEmpty>
			<isNotEmpty prepend="," property="pay_password">
				pay_password
			</isNotEmpty>
			,ctrip_status,create_time,opt_person
				
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="ctrip_name">
				 #ctrip_name:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_password">
				#ctrip_password:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_username">
				#ctrip_username:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_phone">
				#ctrip_phone:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="cookie">
			    #cookie:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="cid">
				 #cid:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="auth">
				 #auth:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="sauth">
				 #sauth:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="pay_password">
				#pay_password:VARCHAR#
			</isNotEmpty>
			,'11',now(),#opt_person:VARCHAR#
			)
		</dynamic>
	</insert>
	<!-- 修改账号信息 -->
	<update id="updateCtripAccount" parameterClass="java.util.HashMap">
		update  ctrip_accountinfo set
		<dynamic prepend=" ">
			<isNotEmpty prepend="," property="ctrip_name">
				 ctrip_name = #ctrip_name:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_password">
				ctrip_password = #ctrip_password:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_username">
				ctrip_username = #ctrip_username:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_phone">
				ctrip_phone = #ctrip_phone:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="cookie">
				cookie = #cookie:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="cid">
				cid = #cid:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="auth">
				auth = #auth:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="sauth">
				sauth = #sauth:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ctrip_status">
				ctrip_status = #ctrip_status:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="pay_password">
				pay_password = #pay_password:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="result_type">
				result_type = #result_type:Integer#
			</isNotEmpty>
				,option_time = now(),opt_person =#opt_person:VARCHAR#
		</dynamic>
		where ctrip_id = #ctrip_id#
	</update>	
	<!-- 插入账号操作日志 -->
	<insert id="insertCtriplogs" parameterClass="java.util.HashMap">
		insert into ctrip_accountinfo_log
		(content,create_time,opt_person) values
		(#content:VARCHAR#,now(),#opt_person:VARCHAR#)
	</insert>
	
	<!-- 查看用户名是否存在 -->
	<select id="queryCtrip_name" parameterClass="java.lang.String" 
	resultClass="java.lang.String">
	SELECT ctrip_name FROM ctrip_accountinfo 
	WHERE ctrip_name = #ctrip_name:VARCHAR#
	</select>
	
	<!-- 查看日志 -->
	<select id="queryCtripAccountLogList" parameterClass="java.util.HashMap" 
	resultClass="java.util.HashMap">
	SELECT log_id,content,create_time,opt_person FROM ctrip_accountinfo_log order by create_time desc LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	
	
	<!-- 日志总数 -->
	<select id="queryCtripAccountLogCount" resultClass="java.lang.Integer">
	SELECT count(1) FROM ctrip_accountinfo_log 
	</select>
	
	<!-- 查看出票金额设置 -->
	<select id="queryAmountArea" resultClass="java.util.HashMap">
		SELECT id,limit_begin,limit_end,acc_degree FROM ctrip_amountarea_conf order by acc_degree asc 
	</select>
	<!-- 修改出票金额设置 -->
	<update id="updateAmountArea" parameterClass="java.util.HashMap">
		update  ctrip_amountarea_conf set
			limit_begin = #limit_begin#,
			limit_end = #limit_end#
			,option_time = now()
		where id = #id#
	</update>
</sqlMap>