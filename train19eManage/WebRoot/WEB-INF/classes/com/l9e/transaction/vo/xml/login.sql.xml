<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="login">
	<!-- 查询数据库user信息 -->
	<select id="queryLogin_UserInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT login.user_id,login.user_name,login.real_name,login.password,login.email,login.user_phone,
		login.user_IsOpen,login.user_status,login.user_level,login.remark,login.supervise_name
		FROM login_userinfo login WHERE login.user_name=#user_name# AND login.password=#password#
	</select>
	
	<!-- 查询用户列表条数 -->
	<select id="queryLoginUserListCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM login_userinfo login WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="user_name">
					login.user_name=#user_name:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="user_id">
					login.user_id=#user_id:VARCHAR#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查询用户列表 -->
	<select id="queryLoginUserList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT login.user_id,login.user_name,login.real_name,login.email,login.user_phone,login.user_IsOpen,login.user_status,login.user_level,login.remark 
		,login.supervise_name,login.last_login_time,login.last_login_ip FROM login_userinfo login WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="user_name">
					login.user_name=#user_name:VARCHAR#
			</isNotEmpty>
		</dynamic>
		ORDER BY login.user_level DESC, login.user_id LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	
	<!-- 查询用户列表非管理员 -->
	<select id="queryLoginUserListOnly" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT login.user_id,login.user_name,login.real_name,login.email,login.user_phone,login.user_IsOpen,login.user_status,login.user_level,login.remark 
		,login.supervise_name,login.last_login_time,login.last_login_ip FROM login_userinfo login WHERE login.user_id = #user_id# 
	</select>
	
	<!-- 删除账号 -->
	<delete id="deleteUserAccount" parameterClass="java.lang.String">
		DELETE FROM login_userinfo WHERE user_id= #user_id#
	</delete>
	
	<!-- 修改账号user_IsOpen启用或停用 -->
	<update id="updateUserIsOpen" parameterClass="java.util.HashMap">
		UPDATE login_userinfo login SET login.user_IsOpen=#user_IsOpen# WHERE login.user_id=#user_id#
	</update>
	
	<!-- 查询修改明细 -->
	<select id="queryUpdateUserInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT login.user_id,login.user_name,login.real_name,login.password,login.email,
		login.user_phone,login.user_IsOpen,login.user_status,login.user_level,login.remark,login.supervise_name 
		FROM login_userinfo login WHERE login.user_id=#user_id# 
	</select>
	
	<!-- 执行修改 -->
	<update id="updateUserInfo" parameterClass="java.util.HashMap">
		UPDATE login_userinfo 
		<dynamic prepend="set">
			<isNotEmpty prepend="," property="password">
				password=#password:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="email">
				email=#email:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="user_phone">
				user_phone =#user_phone#
			</isNotEmpty>
			<isNotEmpty prepend="," property="user_level">
				user_level =#user_level#
			</isNotEmpty>
			<isNotEmpty prepend="," property="user_status">
				user_status =#user_status#
			</isNotEmpty>
			<isNotEmpty prepend="," property="remark">
				remark =#remark#
			</isNotEmpty>
			<isNotEmpty prepend="," property="supervise_name">
				supervise_name =#supervise_name#
			</isNotEmpty>
		</dynamic>
		WHERE user_id=#user_id#
	</update>
	
	<!-- 添加账号 -->
	<insert id="addUser" parameterClass="java.util.HashMap">
		insert into login_userinfo
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="user_id">
				 	user_id
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_name">
					user_name
				</isNotEmpty>
				<isNotEmpty prepend="," property="real_name">
					real_name
				</isNotEmpty>
				<isNotEmpty prepend="," property="password">
					password
				</isNotEmpty>
				<isNotEmpty prepend="," property="email">
					email
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_phone">
					user_phone
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_IsOpen">
					user_IsOpen
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_status">
					user_status
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_level">
					user_level
				</isNotEmpty>
				<isNotEmpty prepend="," property="remark">
					remark
				</isNotEmpty>
				<isNotEmpty prepend="," property="supervise_name">
					supervise_name
				</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="user_id">
				 	#user_id:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_name">
					#user_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="real_name">
					#real_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="password">
					#password:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="email">
					#email:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_phone">
					#user_phone:VARCHAR#
				</isNotEmpty>
				
				<isNotEmpty prepend="," property="user_IsOpen">
					#user_IsOpen:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_status">
					#user_status:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_level">
					#user_level:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="remark">
					#remark:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="supervise_name">
					#supervise_name:VARCHAR#
				</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 验证账号是否存在 -->
	<select id="queryUsername" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT user_name FROM login_userinfo WHERE user_name=#user_name#
	</select>
	<!-- 验证真实姓名是否重复 -->
	<select id="queryRealname" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT count(1) FROM login_userinfo WHERE real_name=#real_name#
	</select>
	<!-- 添加登录日志 -->
	<insert id="addLogin_Log" parameterClass="java.util.HashMap">
		INSERT INTO login_logs (user_id,user_name,real_name,login_time,login_ip)
		 VALUES (#user_id#,#user_name#,#real_name#,NOW(),#login_ip#)
	</insert>
	
	<!-- 修改最后登录时间和ip -->
	<update id="updateLoginTimeAndIp" parameterClass="java.util.HashMap">
		UPDATE login_userinfo SET last_login_time=NOW() ,last_login_ip=#login_ip# WHERE user_id=#user_id#
	</update>
	
	<!-- 查询登录日志条数 -->
	<select id="queryLoginLogsListCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM login_logs l 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				 DATE_FORMAT(login_time,'%Y-%m-%d')<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				 DATE_FORMAT(login_time,'%Y-%m-%d')<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="user_name">
					user_name=#user_name:VARCHAR#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查询登录日志列表 -->
	<select id="queryLoginLogsList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT l.login_log_id,l.user_id,l.user_name,l.real_name,l.login_time,l.login_ip FROM login_logs l 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				 DATE_FORMAT(login_time,'%Y-%m-%d')<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				 DATE_FORMAT(login_time,'%Y-%m-%d')<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="user_name">
					user_name=#user_name:VARCHAR#
			</isNotEmpty>
		</dynamic>
		ORDER BY login_time DESC LIMIT #everyPagefrom:Integer#,#pageSize:Integer#
	</select>
	
	<!-- 查询全国的各个省 -->
	<select id="getProvince"
		resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area WHERE area_rank=1 AND  area_no<![CDATA[<>]]>'000000' ORDER
		BY area_id ASC
	</select>
	
	<!-- 查询用户的登录次数 -->
	<select id="queryUserLoginTotal" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM login_logs WHERE user_id=#user_id#
	</select>
	
	
</sqlMap>