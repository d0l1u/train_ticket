<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="cpStat">
	<!-- 查询条数 -->
	<select id="querycpStatServiceListCount" parameterClass="java.util.HashMap" 
			 resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM cp_statInfo cp WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				cp.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				cp.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	         	  channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查询列表 -->
	<select id="querycpStatServiceList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(cp.order_time,'%Y-%m-%d')AS order_time,cp.channel,cp.order_succeed,cp.order_defeated,
		cp.order_count,cp.succeed_money,cp.defeated_money,cp.ticket_count 
		FROM cp_statInfo cp WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				cp.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				cp.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	         	  channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
		</dynamic>
		ORDER BY order_time DESC  LIMIT #everyPagefrom:Integer#,#pageSize:Integer#
	</select>
	
	<!-- 15日内19e与去哪网的销售情况 -->
	<select id="queryPictureLineParam" resultClass="java.util.HashMap">
		SELECT 19e.*,qunar.* FROM(
			SELECT DATE_FORMAT(a.order_time,'%Y-%m-%d')AS order_time_19e,(a.order_succeed)AS order_succeed_19e 
				FROM cp_statInfo a WHERE a.channel='19e')AS 19e
			LEFT JOIN (SELECT DATE_FORMAT(b.order_time,'%Y-%m-%d')AS order_time_qunar,(b.order_succeed)AS order_succeed_qunar 
				FROM cp_statInfo b WHERE b.channel='qunar')AS qunar
			ON 19e.order_time_19e = qunar.order_time_qunar
		WHERE 19e.order_time_19e BETWEEN DATE_SUB(CURDATE(), INTERVAL 15 DAY) AND CURDATE()
	</select>
</sqlMap>