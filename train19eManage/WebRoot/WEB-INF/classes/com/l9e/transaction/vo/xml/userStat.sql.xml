<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="userStat">
	<!-- 查询条数 -->
	<select id="queryOrderStatListCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) 
		FROM tj_userInfo t WHERE 1=1 
		<dynamic prepend="">
			<isNotEqual compareValue="-1" property="area_no">
				<isNotEmpty prepend=" and " property="area_no">
					t.area_no=#area_no#
				</isNotEmpty>
			</isNotEqual>
			<isNotEmpty prepend=" and " property="begin_time">
				t.tj_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				t.tj_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查询列表 -->
	<select id="queryUserStatList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT t.tj_id,t.area_no,t.area_name,DATE_FORMAT(t.tj_time,'%Y-%m-%d')AS tj_time,t.user_total,t.user_increase,CONVERT(user_rate_increase,CHAR)AS user_rate_increase,
		t.active_user,t.active_user_total,t.active_increase,CONVERT(active_rate_increase,CHAR)AS  active_rate_increase
		FROM tj_userInfo t WHERE 1=1 
		<dynamic prepend="">
			<isNotEqual compareValue="-1" property="area_no">
				<isNotEmpty prepend=" and " property="area_no">
					t.area_no=#area_no#
				</isNotEmpty>
			</isNotEqual>
			<isNotEmpty prepend=" and " property="begin_time">
				t.tj_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				t.tj_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
		</dynamic>
		ORDER BY tj_time DESC ,user_total DESC LIMIT #everyPagefrom:Integer#,#pageSize:Integer#
	</select>
	
	<!-- 查询15日内用户增长与活跃用户增长趋势 -->
	<select id="queryUserStatPictureLine" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(t.tj_time,'%Y-%m-%d')AS tj_time,user_increase ,t.active_increase FROM tj_userInfo t
		WHERE area_no='000000' AND tj_time BETWEEN DATE_SUB(CURDATE(), INTERVAL 15 DAY) AND CURDATE()
		ORDER BY tj_time ASC
	</select>
	
	<select id="getProvince" resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area WHERE area_rank=1 ORDER BY area_id ASC
	</select>
	
	<!-- 查询本省当日15天用户增长趋势 -->
	<select id="queryThisDayUserStat" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(t.tj_time,'%Y-%m-%d')AS tj_time,t.user_increase FROM tj_userInfo t 
		WHERE t.area_no=#area_no# AND tj_time BETWEEN DATE_SUB(#tj_time#, INTERVAL 15 DAY) AND #tj_time#
		ORDER BY tj_time ASC
	</select>
	
	<!-- 查询本省当日15天活跃用户增长趋势 -->
	<select id="queryThisDayUserStatActive" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(t.tj_time, '%Y-%m-%d') AS tj_time, t.active_user FROM tj_userInfo t 
		WHERE t.area_no = #area_no# AND tj_time BETWEEN DATE_SUB(#tj_time#, INTERVAL 15 DAY) AND #tj_time#
		ORDER BY tj_time ASC 
	</select>
	
	<!-- 查询全部省的用户量柱状图 -->
	<select id="queryAllPrivateUserBar" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(t.tj_time,'%Y-%m-%d')AS tj_time,t.area_name,t.area_no,t.user_total FROM tj_userInfo t WHERE t.area_no<![CDATA[<>]]>'000000' 
		AND DATE_FORMAT(t.tj_time,'%Y-%m-%d')=#date#
	</select>
	
	<!-- 查询前一天本省销售的数量 -->
	<select id="queryPreProvinceCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM hc_orderinfo h WHERE DATE_FORMAT(h.create_time,'%Y-%m-%d')=DATE_SUB(#thisDay#,INTERVAL 1 DAY) AND h.at_province_id=#area_no#
	</select>
	<!-- 查询本天本省销售的数量 -->
	<select id="queryThisProvinceCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM hc_orderinfo h WHERE DATE_FORMAT(h.create_time,'%Y-%m-%d')=#thisDay# AND h.at_province_id=#area_no#
	</select>
	<!-- 查询一周前的销售数量 -->
	<select id="queryAWeekAgoCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM hc_orderinfo h WHERE DATE_FORMAT(h.create_time,'%Y-%m-%d')=DATE_SUB(#thisDay#,INTERVAL 6 DAY) AND h.at_province_id=#area_no#
	</select>
</sqlMap>