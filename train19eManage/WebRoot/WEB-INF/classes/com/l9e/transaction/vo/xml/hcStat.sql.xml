<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="hcStat">

	<!-- 查询条数 -->
	<select id="queryHcStatCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)
		FROM tj_hc_orderInfo t WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				t.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				t.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	         	  channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查询列表 -->
	<select id="queryHcStatList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(t.order_time,'%Y-%m-%d')AS order_time,t.out_ticket_succeed,t.out_ticket_defeated,t.over_time, t.preparative_count,t.pay_defeated,
		t.refund_count,t.ticket_count,t.order_count,t.succeed_money,t.defeated_money,t.change_money,t.bx_count,t.bx_countMoney,t.succeed_odds,t.out_time_order,t.cancel_order,
		t.succeed_cgl,t.svip_num,t.svip_lose,t.succeed_sbl,IFNULL(t.succeed_vip_sbl,'0.00%')AS succeed_vip_sbl,t.channel,t.active,t.agent_login_num,t.vip_lose,t.out_ticket_XL
		,DATE_FORMAT(t.order_time,'%d')AS order_time_day ,t.refund_money ,t.pay_time ,t.holdseat_cgl,t.holdseat_sbl
		FROM tj_hc_orderInfo t WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				t.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				t.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	         	  channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
		</dynamic>
		ORDER BY t.order_time DESC, t.channel LIMIT #everyPagefrom:Integer#,#pageSize:Integer#
	</select>
	
	<!-- 导出列表 -->
	<select id="queryHcStatExcel" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(t.order_time,'%Y-%m-%d')AS order_time,t.out_ticket_succeed,t.out_ticket_defeated,t.over_time, t.preparative_count,t.pay_defeated,
		t.refund_count,t.ticket_count,t.order_count,t.succeed_money,t.defeated_money,t.change_money,t.bx_count,t.bx_countMoney,t.succeed_odds,t.out_time_order,t.cancel_order,
		t.succeed_cgl,t.svip_num,t.svip_lose,t.succeed_sbl,IFNULL(t.succeed_vip_sbl,'0.00%')AS succeed_vip_sbl,t.channel,t.active,t.agent_login_num,t.vip_lose,t.out_ticket_XL
		,DATE_FORMAT(t.order_time,'%d')AS order_time_day ,t.refund_money ,t.pay_time ,t.holdseat_cgl,t.holdseat_sbl
		FROM tj_hc_orderInfo t WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				t.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				t.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	         	  channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
		</dynamic>
		ORDER BY t.order_time DESC
	</select>
	
	<!-- 查询当天活跃数-->
	<select id="queryActiveUser" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM(
		SELECT DISTINCT hu.user_id FROM hc_userinfo hu  
		LEFT JOIN hc_orderinfo hc ON hc.dealer_id=hu.user_id  
		WHERE hc.order_id IS NOT NULL  
		AND DATE_FORMAT(hc.create_time,'%Y-%m-%d') =#order_time#)AS a
	</select>
	
	<!-- 查询Hc_statInfo_province表 -->
	<select id="queryHc_statInfo_provinceList" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(hp.order_time,'%Y-%m-%d')AS order_time,hp.province_name,hp.province_id,hp.user_count,hp.activeAgent,
		hp.apply_count,hp.not_pass,hp.wait_pass,hp.order_count,hp.ticket_count,hp.bx_count,hp.bx_Money_Sum,hp.succeed_money,hp.defeated_money, 
		hp.succeed_count,hp.defeated_count,hp.pay_fall,hp.mouth_count,hp.last_mouth_count,hp.want_outTicket FROM hc_statInfo_province hp 
		WHERE hp.order_time=#create_time# ORDER BY hp.last_mouth_count DESC
	</select>
	
	<!-- 查询截止当日各省销售票数总计 -->
	<select id="queryProvinceTotal_Ticket" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT CONVERT(SUM(ticket_count),char)as ticket_count, CONVERT(SUM(today_money),char)as today_money FROM hc_statInfo_province 
		WHERE province_id=#province_id# AND DATE_FORMAT(order_time,'%Y-%m-%d')<![CDATA[<=]]>#create_time#
	</select>
	
	<select id="querySupervise_nameToArea_no" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT area_no,area_name FROM gen_area WHERE area_name=#area_name# AND area_rank='1'
	</select>
	
	<!-- 省级代理List查询条数 -->
	<select id="querySuperviseAreaCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)
		FROM hc_statInfo_province p WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				p.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				p.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isEqual compareValue="-1" property="province_id">
				<isNotEmpty prepend=" and " property="supervise_name_List">
					province_name in
					<iterate open="(" close=")" conjunction=","
						property="supervise_name_List">
						#supervise_name_List[]:VARCHAR#
					</iterate>
				</isNotEmpty>
			</isEqual>
			<isNotEqual compareValue="-1" property="province_id">
				<isNotEmpty prepend=" and " property="province_id">
					province_id =#province_id#
				</isNotEmpty>
			</isNotEqual>
		</dynamic>
	</select>
	<!-- 省级代理List -->
	<select id="querySuperviseAreaList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT DATE_FORMAT(p.order_time,'%Y-%m-%d')AS order_time,p.province_name,p.province_id,p.user_count,p.activeAgent,
		p.apply_count,p.not_pass,p.wait_pass,p.order_count,p.ticket_count,p.bx_count,p.bx_Money_Sum,p.succeed_count,p.defeated_count,
		p.want_outTicket,p.pay_fall,p.succeed_money,p.defeated_money
		FROM hc_statInfo_province p WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				p.order_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				p.order_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isEqual compareValue="-1" property="province_id">
				<isNotEmpty prepend=" and " property="supervise_name_List">
					province_name in
					<iterate open="(" close=")" conjunction=","
						property="supervise_name_List">
						#supervise_name_List[]:VARCHAR#
					</iterate>
				</isNotEmpty>
			</isEqual>
			<isNotEqual compareValue="-1" property="province_id">
				<isNotEmpty prepend=" and " property="province_id">
					province_id =#province_id#
				</isNotEmpty>
			</isNotEqual>
		</dynamic>
		ORDER BY p.order_time DESC LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	
	<!-- 查询当天Vip订单失败数 -->
	<select id="queryVipLose" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM cp_orderinfo cp 
		WHERE cp.LEVEL<![CDATA[<>]]>0 AND cp.LEVEL IS NOT NULL AND cp.order_status='10' 
		AND DATE_FORMAT(cp.create_time,'%Y-%m-%d')=#order_time#
	</select>
	
	<!-- 查询历史最高票数、交易量，平均成功率 -->
	<select id="queryHistory" resultClass="java.util.HashMap">
		SELECT 
		  CONVERT(MAX(ticket_count), CHAR) out_ticket_succeed,
		  CONVERT(MAX(succeed_money), CHAR) succeed_money,
		  CONVERT(ROUND(AVG(succeed_cgl), 2), CHAR) succeed_cgl 
		FROM
		  tj_hc_orderInfo 
		WHERE channel = '19e' 
	</select>
	
	<!-- 查询昨日出票成功数、失败票数、成功金额 -->
	<select id="queryYesterdayTicketMoney" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT 
		  CONVERT(IFNULL(out_ticket_succeed,0), CHAR) AS ticket_succeed,
		  CONVERT(IFNULL(out_ticket_defeated,0), CHAR) AS ticket_defeated,
		  CONVERT(IFNULL(SUM(succeed_money), 0), CHAR) AS buy_money,
		  CONVERT(IFNULL(ticket_count,0),CHAR) AS ticket_count
		FROM
		  tj_hc_orderInfo
		WHERE date_format(order_time,'%Y-%m-%d') = #create_time# AND channel='19e' 
		GROUP BY succeed_money ,out_ticket_defeated,out_ticket_succeed
	</select>
	
	
	
	<!--分时统计表-->
	<select id="querytongjiList" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT 
		     COUNT(hc.order_id)
		  FROM
		    cp_orderinfo hc 
		    LEFT JOIN
			  cp_orderinfo_cp a 
			  ON hc.order_id=a.order_id 
		  WHERE 1 = 1 AND hc.order_status='99' 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="channel">
	         	  hc.channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<!--分时统计表Qunar-->
	<select id="querytongjiListQunar" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM qunar_orderinfo_cp cp LEFT JOIN qunar_orderinfo hc ON cp.order_id=hc.order_id 
		WHERE  hc.order_status='44'	
		AND  hc.order_source=#order_source#
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<!--分时统计表Inner总-->
	<select id="querytongjiListInner" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM inner_orderinfo_cp cp LEFT JOIN inner_orderinfo hc ON cp.order_id=hc.order_id 
		WHERE hc.order_status='44' 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<!--分时统计表Ext总 -->
	<select id="querytongjiListExt" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM ext_orderinfo_cp cp LEFT JOIN ext_orderinfo hc ON cp.order_id=hc.order_id 
		WHERE  hc.order_status='44'	 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>



	<!--分时统计表-->
	<select id="querytongjiListOrder" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT 
		     COUNT(hc.order_id)
		  FROM
		    cp_orderinfo hc 
		  WHERE 1 = 1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="channel">
	         	  hc.channel in
		          <iterate open="(" close=")" conjunction="," property="channel">
		            	#channel[]:VARCHAR#
		      	  </iterate>
	      	 </isNotEmpty>
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<!--分时统计表Qunar-->
	<select id="querytongjiListQunarOrder" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM qunar_orderinfo hc 
		WHERE 1=1
		AND  hc.order_source=#order_source#
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<!--分时统计表Inner总-->
	<select id="querytongjiListInnerOrder" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM inner_orderinfo hc 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<!--分时统计表Ext总 -->
	<select id="querytongjiListExtOrder" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM  ext_orderinfo hc 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.create_time <![CDATA[>=]]> CONCAT(#create_time#, #hour#':00:00') 
				AND hc.create_time <![CDATA[<]]> CONCAT(#create_time#, #hour#':59:59')
			</isNotEmpty>
		</dynamic>
	</select>


	<!-- 查询条数 -->
	<select id="check_num" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM cp_count WHERE type='02' AND channel=#channel# AND code=#code#
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="success_num" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM cp_count WHERE code='01' AND channel=#channel# AND type='02'
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="fail_num" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM cp_count WHERE code='02' AND channel=#channel# AND type='02'
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="order_num_elong" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM elong_orderinfo
		WHERE 	1=1 and channel ='elong' 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 在此新增查询同程和美团订单数接口 -->
	<select id="order_num_tongcheng" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM elong_orderinfo
		WHERE 	1=1 and channel ='tongcheng' 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="order_num_meituan" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM mt_orderinfo
		WHERE 	1=1 and channel ='meituan' 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="order_num_gt" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM gt_orderinfo
		WHERE 	1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="order_num_qunar" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM qunar_orderinfo
		WHERE 	1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="add_user_num" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(*)  FROM hc_userinfo hc
		 LEFT JOIN gen_area g1
		 ON hc.province_id=g1.area_no
		 AND g1.area_rank=1
		 LEFT JOIN gen_area g2
		 ON hc.city_id=g2.area_no
		 AND g2.area_rank=2
		 LEFT JOIN gen_area g3
		 ON hc.district_id=g3.area_no
		 AND g3.area_rank=3 where 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				hc.auditing_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND hc.auditing_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
		</dynamic>
	</select>
	<select id="regist_num" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT 
		  COUNT(*)
		FROM
		  hc_orderinfo_regist where account_source='1' 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="create_time">
				create_time <![CDATA[>=]]> CONCAT(#create_time#, ' 00:00:00') AND create_time <![CDATA[<]]> CONCAT(#create_time#, ' 23:59:59')
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="regist_status">
				regist_status =#regist_status#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="fail_reason">
				fail_reason =#fail_reason#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<select id="queryTjCode" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT card_no,count(*) num ,SUBSTR(create_time,12,2) time from cp_workercode_info t  where t.create_time>#date# and CONCAT(#date#,' 23:00:00')>t.create_time
  		group by card_no,SUBSTR(create_time,12,2)
	</select>
	
	
</sqlMap>