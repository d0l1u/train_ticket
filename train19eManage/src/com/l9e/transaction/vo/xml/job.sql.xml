<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="job">
	
	<!-- 查询预订订单列表 -->
	<select id="queryScanedOrderList" resultClass="java.util.HashMap">
		SELECT hc.order_id, hc.order_name, CONVERT(hc.ticket_pay_money,CHAR) AS ticket_pay_money, hc.from_city, hc.to_city,
			DATE_FORMAT(hc.from_time,'%Y-%m-%d %H:%i:%s') as from_time,
			DATE_FORMAT(hc.to_time,'%Y-%m-%d %H:%i:%s') as to_time, DATE_FORMAT(hc.travel_time,'%Y-%m-%d') as travel_time
			,hc.train_no,CONVERT(hc.seat_type,CHAR) as seat_type,CONVERT(hc.out_ticket_type,CHAR) as out_ticket_type 
			 FROM hc_orderinfo hc
			WHERE hc.order_status='12'
				AND hc.timeout='1'
        ORDER BY hc.create_time DESC
        LIMIT 0,5
	</select>
	
	<!-- 根据订单号查询车票信息 -->
	<select id="queryCpInfoList" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT cp.cp_id,cp.order_id,cp.user_name,CONVERT(cp.ticket_type,CHAR) as ticket_type,
		CONVERT(cp.ids_type,CHAR) as ids_type,cp.user_ids,CONVERT(cp.seat_type,CHAR) as seat_type,
		CONVERT(cp.pay_money,CHAR) as pay_money
			FROM hc_orderinfo_cp cp 
		WHERE cp.order_id=#order_id:VARCHAR#
	</select>
	
	<!-- 修改通知信息 -->
	<update id="updateScanInfoById" parameterClass="java.util.HashMap">
		UPDATE hc_orderinfo hc 
		SET hc.timeout = #timeout:VARCHAR#,
			hc.order_status='22'
		WHERE hc.order_id=#order_id:VARCHAR#
			and hc.timeout = '1'
			and hc.order_status='12'
	</update>
	
</sqlMap>