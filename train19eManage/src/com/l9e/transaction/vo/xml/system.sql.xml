<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="system">

	<!-- 查询账号条数 -->
	<select id="querySystemListCount" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM
		(
		SELECT a.config_id, a.province_id, a.is_open, a.is_cost, a.is_ps, a.is_buyable,
				DATE_FORMAT(a.modify_time,'%Y-%m-%d %H:%i:%s') AS modify_time,
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				a.rule_content, a.opt_ren
				 FROM hc_system_config a
				WHERE 1=1
			<dynamic prepend="">
	      		<isNotEqual compareValue="000000" property="province_id">
	           <isNotEmpty prepend=" and " property="province_id">
	              a.province_id=#province_id:VARCHAR#
	          </isNotEmpty>
	    		</isNotEqual>
	        </dynamic>
	        ORDER BY a.create_time DESC
		) as temp
		
	</select>
	
	
	<!-- 查询账号信息 -->
	<select id="querySystemList" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		SELECT a.config_id, province.area_name, a.is_open, a.is_cost, a.is_ps, 
				a.is_buyable,
				DATE_FORMAT(a.modify_time,'%Y-%m-%d %H:%i:%s') AS modify_time,
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				a.rule_content, a.opt_ren
				 FROM hc_system_config a, gen_area province
				WHERE 1=1 and a.province_id=province.area_no
			<dynamic prepend="">
	        <isNotEqual compareValue="000000" property="province_id">
	           <isNotEmpty prepend=" and " property="province_id">
	              a.province_id=#province_id:VARCHAR#
	          </isNotEmpty>
	        </isNotEqual>
	        </dynamic>
	        ORDER BY a.create_time DESC
        LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	
	<!-- 判断省份是否存在 -->
	<select id="queryProvinceIsExist" parameterClass="java.lang.String"
		resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM hc_system_config where province_id=#province_id:VARCHAR#
	</select>
	
	<!-- 查询账号明细信息 -->
	<select id="querySystem" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT a.config_id, province.area_name, a.is_open, a.is_cost, a.is_ps, 
				DATE_FORMAT(a.modify_time,'%Y-%m-%d %H:%i:%s') AS modify_time,
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				a.is_buyable,
				a.rule_content, a.opt_ren
				 FROM hc_system_config a, gen_area province
				WHERE a.config_id=#config_id:VARCHAR# and a.province_id=province.area_no
	</select>
	
	
	<!-- 更新账号信息 -->
	<update id="updateSystem" parameterClass="com.l9e.transaction.vo.SystemVo">
		UPDATE hc_system_config
			<dynamic prepend="SET">
				<isNotEmpty prepend="," property="province_id">
				 	province_id=#province_id:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="is_open">
					is_open=#is_open:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="is_cost">
					is_cost=#is_cost:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="is_ps">
					is_ps=#is_ps:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="is_buyable">
					is_buyable=#is_buyable:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="rule_content">
					rule_content=#rule_content:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_ren">
					opt_ren=#opt_ren:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="is_ps">
				  modify_time=now()
				</isNotEmpty>
			</dynamic>
			WHERE config_id=#config_id:VARCHAR#
	</update>
	
	<!-- 插入账号信息 -->
	<insert id="insertSystem" parameterClass="com.l9e.transaction.vo.SystemVo">
		insert into hc_system_config
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="province_id">
				 province_id
			</isNotEmpty>
			<isNotEmpty prepend="," property="is_open">
				is_open
			</isNotEmpty>
			<isNotEmpty prepend="," property="is_cost">
				is_cost
			</isNotEmpty>
			
			<isNotEmpty prepend="," property="is_ps">
				is_ps
			</isNotEmpty>
			<isNotEmpty prepend="," property="is_buyable">
				is_buyable
			</isNotEmpty>
			<isNotEmpty prepend="," property="rule_content">
				rule_content
			</isNotEmpty>
			<isNotEmpty prepend="," property="province_id">
				create_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				opt_ren
			</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="province_id">
				 #province_id:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="is_open">
				#is_open:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="is_cost">
				#is_cost:VARCHAR#
			</isNotEmpty>
			
			<isNotEmpty prepend="," property="is_ps">
				#is_ps:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="is_buyable">
				#is_buyable:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="rule_content">
				#rule_content:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="province_id">
				now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				#opt_ren:VARCHAR#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 删除账号信息 -->
	<delete id="deleteSystem" parameterClass="com.l9e.transaction.vo.SystemVo">
		delete from hc_system_config where config_id=#config_id:VARCHAR#
	</delete>
	
	<!-- 查询接口状态 -->
	<select id="querySetting" resultClass="java.lang.String">
		SELECT hc.setting_value FROM hc_system_setting hc WHERE hc.setting_name='INTERFACE_CHANNEL'
	</select>
	
	<!-- 修改接口 -->
	<update id="updateSetting" parameterClass="java.util.HashMap">
		UPDATE hc_system_setting hc 
		SET 
		hc.setting_name='INTERFACE_CHANNEL'
		<isNotEmpty prepend="," property="setting_value">
			hc.setting_value=#setting_value#
		</isNotEmpty>
		WHERE hc.setting_name='INTERFACE_CHANNEL'
	</update>
	
	<select id="getProvince" resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area where area_rank=1 order by area_id asc
	</select>
	
	<select id="getCity" parameterClass="java.lang.String" resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area where area_rank=2 and area_parentno=#provinceid# order by area_id asc
	</select>
	
	<select id="getArea"  parameterClass="java.lang.String" resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area  where area_rank=3 and area_parentno=#cityid# order by area_id asc
	</select>
	
	<!-- 批量可以购买 -->
	<update id="updateEstateNot" parameterClass="java.util.HashMap">
		UPDATE hc_system_config sys SET sys.is_buyable=#is_buyable#,sys.modify_time=NOW(),sys.opt_ren=#opt_ren# WHERE sys.config_id=#config_id#
	</update>
</sqlMap>