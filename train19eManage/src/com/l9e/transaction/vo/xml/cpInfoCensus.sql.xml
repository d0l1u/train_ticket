<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="cpInfoCensus">
	<!-- 查询前一天订单成功数 -->
	<select id="queryPre_day_order_succeed" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM cp_orderinfo cp 
		WHERE cp.order_status='99' AND cp.channel=#channel#
		AND DATE_FORMAT(cp.create_time,'%Y-%m-%d')=#create_time#
	</select>
	<!-- 查询前一天订单失败数 -->
	<select id="queryPre_day_order_defeated" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM cp_orderinfo cp 
		WHERE cp.order_status='10' AND cp.channel=#channel#
		AND DATE_FORMAT(cp.create_time,'%Y-%m-%d')=#create_time#
	</select>
	<!-- 查询前一天出票成功价钱 -->
	<select id="queryPre_succeed_money" parameterClass="java.util.HashMap" resultClass="java.lang.Double">
		SELECT IFNULL(SUM(pay_money),0) FROM cp_orderinfo cp
		WHERE cp.order_status ='99' AND cp.channel=#channel#
		AND DATE_FORMAT(cp.create_time,'%Y-%m-%d')=#create_time#
	</select>
	<!-- 查询前一天出票失败价钱 -->
	<select id="queryPre_defeated_money" parameterClass="java.util.HashMap"  resultClass="java.lang.Double">
		SELECT IFNULL(SUM(pay_money),0) FROM cp_orderinfo cp
		WHERE cp.order_status ='10' AND cp.channel=#channel#
		AND DATE_FORMAT(cp.create_time,'%Y-%m-%d')=#create_time#
	</select>
	<!-- 查询前一天出售的票数 -->
	<select id="queryPre_ticket_count" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM cp_orderinfo_cp cpc 
		LEFT JOIN cp_orderinfo cp ON cpc.order_id=cp.order_id 
		WHERE cp.order_status='99' AND cp.channel=#channel#
		AND DATE_FORMAT(cpc.create_time,'%Y-%m-%d')=#create_time#
	</select>
	
	<!-- 插入19e统计数据 -->
	<insert id="addCensusTocp_statInfo_19e" parameterClass="java.util.HashMap">
		INSERT INTO cp_statInfo 
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="order_time">
				order_time
			</isNotEmpty>
			,create_time
			<isNotEmpty prepend="," property="channel">
				channel
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_succeed">
				order_succeed
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_defeated">
				order_defeated
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_count">
				order_count
			</isNotEmpty>
			<isNotEmpty prepend="," property="succeed_money">
				succeed_money
			</isNotEmpty>
			<isNotEmpty prepend="," property="defeated_money">
				defeated_money
			</isNotEmpty>
			<isNotEmpty prepend="," property="ticket_count">
				ticket_count
			</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="order_time">
				 #order_time#
			</isNotEmpty>
			,NOW()
			<isNotEmpty prepend="," property="channel">
				#channel#
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_succeed">
				#order_succeed#
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_defeated">
				#order_defeated#
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_count">
				#order_count#
			</isNotEmpty>
			<isNotEmpty prepend="," property="succeed_money">
				#succeed_money#
			</isNotEmpty>
			<isNotEmpty prepend="," property="defeated_money">
				#defeated_money#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ticket_count">
				#ticket_count#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
	<!-- 插入qunar统计数据 -->
	<insert id="addCensusTocp_statInfo_qunar" parameterClass="java.util.HashMap">
		INSERT INTO cp_statInfo 
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="order_time">
				order_time
			</isNotEmpty>
			,create_time
			<isNotEmpty prepend="," property="channel">
				channel
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_succeed">
				order_succeed
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_defeated">
				order_defeated
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_count">
				order_count
			</isNotEmpty>
			<isNotEmpty prepend="," property="succeed_money">
				succeed_money
			</isNotEmpty>
			<isNotEmpty prepend="," property="defeated_money">
				defeated_money
			</isNotEmpty>
			<isNotEmpty prepend="," property="ticket_count">
				ticket_count
			</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="order_time">
				 #order_time#
			</isNotEmpty>
			,NOW()
			<isNotEmpty prepend="," property="channel">
				#channel#
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_succeed">
				#order_succeed#
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_defeated">
				#order_defeated#
			</isNotEmpty>
			<isNotEmpty prepend="," property="order_count">
				#order_count#
			</isNotEmpty>
			<isNotEmpty prepend="," property="succeed_money">
				#succeed_money#
			</isNotEmpty>
			<isNotEmpty prepend="," property="defeated_money">
				#defeated_money#
			</isNotEmpty>
			<isNotEmpty prepend="," property="ticket_count">
				#ticket_count#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 查询表中条数是否为零 -->
	<select id="query_table_count" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM cp_statInfo
	</select>
	
	<!-- 查询时间列表 -->
	<select id="queryDateList" resultClass="java.util.HashMap">
		SELECT DISTINCT DATE_FORMAT(cp.create_time,'%Y-%m-%d')AS create_time FROM cp_orderinfo cp 
	</select>
</sqlMap>