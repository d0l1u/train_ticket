<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="worker">

	<!-- 查询账号条数 -->
	<select id="queryWorkerListCount" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM
		(
		SELECT a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, 
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				a.worker_status,a.spare_thread,a.robot_con_timeout,a.robot_read_timeout 
				 FROM cp_workerinfo a
				WHERE 1=1
			<dynamic prepend="">
	         <isNotEmpty prepend=" and " property="robot_id">
	              a.robot_id=#robot_id:VARCHAR#
	          </isNotEmpty>
	          <isNotEmpty prepend=" and " property="worker_name">
	              a.worker_name=#worker_name:VARCHAR#
	          </isNotEmpty>
	         <isNotEmpty prepend=" and " property="worker_status">
	         	  worker_status in
		          <iterate open="(" close=")" conjunction="," property="worker_status">
		            	#worker_status[]:VARCHAR#
		      	  </iterate>
	      	  </isNotEmpty>
	      	  <isNotEmpty prepend=" and " property="worker_type">
	         	  worker_type in
		          <iterate open="(" close=")" conjunction="," property="worker_type">
		            	#worker_type[]:VARCHAR#
		      	  </iterate>
	      	  </isNotEmpty>
	        </dynamic>
	        ORDER BY a.create_time DESC
		) as temp
		
	</select>
	
	<!-- 查询账号信息 -->
	<select id="queryWorkerList" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		SELECT a.worker_id,a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, 
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				DATE_FORMAT(a.option_time,'%Y-%m-%d %H:%i:%s') AS option_time, 
				a.worker_status, a.opt_name,a.spare_thread,a.robot_id,
				a.robot_con_timeout,a.robot_read_timeout  
				 FROM cp_workerinfo a
				WHERE 1=1
			<dynamic prepend="">
	          <isNotEmpty prepend=" and " property="robot_id">
	              a.robot_id=#robot_id:VARCHAR#
	          </isNotEmpty>
	          <isNotEmpty prepend=" and " property="worker_name">
	              a.worker_name=#worker_name:VARCHAR#
	          </isNotEmpty>
	          <isNotEmpty prepend=" and " property="worker_status">
	         	  worker_status in
		          <iterate open="(" close=")" conjunction="," property="worker_status">
		            	#worker_status[]:VARCHAR#
		      	  </iterate>
	      	  </isNotEmpty>
	      	  <isNotEmpty prepend=" and " property="worker_type">
	         	  worker_type in
		          <iterate open="(" close=")" conjunction="," property="worker_type">
		            	#worker_type[]:VARCHAR#
		      	  </iterate>
	      	  </isNotEmpty>
	        </dynamic>
	        ORDER BY a.create_time DESC
        LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	
	
	<!-- 查询账号信息2 -->
	<select id="queryWorkerList2" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		SELECT a.worker_id,a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, 
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				DATE_FORMAT(a.option_time,'%Y-%m-%d %H:%i:%s') AS option_time, 
				a.worker_status, a.opt_name,a.spare_thread,a.robot_id,
				a.robot_con_timeout,a.robot_read_timeout,a.worker_ext 
				 FROM cp_workerinfo a
				WHERE 1=1
			<dynamic prepend="">
	          <isNotEmpty prepend=" and " property="robot_id">
	              a.robot_id=#robot_id:VARCHAR#
	          </isNotEmpty>
	          <isNotEmpty prepend=" and " property="worker_name">
	              a.worker_name=#worker_name:VARCHAR#
	          </isNotEmpty>
	        </dynamic>
	        ORDER BY a.create_time DESC
	</select>
	
	
	
	
	<select id="queryWorkerByRobotType" resultClass="com.l9e.transaction.vo.WorkerVo" parameterClass="java.util.HashMap">
		SELECT a.worker_id,a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, 
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				DATE_FORMAT(a.option_time,'%Y-%m-%d %H:%i:%s') AS option_time, 
				a.worker_status, a.opt_name,a.spare_thread,a.robot_id,
				a.robot_con_timeout,a.robot_read_timeout,a.worker_ext 
				 FROM cp_workerinfo a
				WHERE a.robot_id=#robot_id#  AND  a.worker_type=#worker_type#
	</select>
	
	
	<!-- 查询账号明细信息 -->
	<select id="queryWorker" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT a.worker_id,a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, a.worker_ext,
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, 
				DATE_FORMAT(a.option_time,'%Y-%m-%d %H:%i:%s') AS option_time, 
				a.worker_status, a.opt_name,a.spare_thread 
				FROM cp_workerinfo a
				WHERE a.worker_id=#worker_id:VARCHAR#
	</select>
	
	
	<!-- 查询账号明细信息 ByRobotId-->
	<select id="queryWorkerByRobotId" parameterClass="java.lang.String" resultClass="com.l9e.transaction.vo.WorkerVo">
		SELECT a.worker_id,a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, a.worker_ext,
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, a.robot_id,
				DATE_FORMAT(a.option_time,'%Y-%m-%d %H:%i:%s') AS option_time, 
				a.worker_status, a.opt_name,a.spare_thread,a.stop_reason,a.proxy_status   
				FROM cp_workerinfo a
				WHERE a.robot_id=#robot_id:VARCHAR#
	</select>
	
	
		<!-- 查询账号明细信息WorkerId -->
	<select id="queryWorkerByWorkerId" parameterClass="java.lang.String" resultClass="com.l9e.transaction.vo.WorkerVo">
		SELECT a.worker_id,a.worker_name, a.worker_type, a.worker_priority, a.order_num, a.max_order_num, a.worker_ext,
				a.worker_vendor,a.worker_region,a.worker_describe,
				DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time, a.robot_id,
				DATE_FORMAT(a.option_time,'%Y-%m-%d %H:%i:%s') AS option_time, 
				a.worker_status, a.opt_name,a.spare_thread,a.robot_con_timeout,a.robot_read_timeout 
				FROM cp_workerinfo a
				WHERE a.worker_id=#worker_id:VARCHAR#
	</select>
	<!-- 更新账号信息 -->
	<update id="updateWorker" parameterClass="com.l9e.transaction.vo.WorkerVo">
		UPDATE cp_workerinfo
			<dynamic prepend="SET">
				<isNotEmpty prepend="," property="worker_name">
				 	worker_name=#worker_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_type">
					worker_type=#worker_type:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_priority">
					worker_priority=#worker_priority:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="order_num">
					order_num=#order_num:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="max_order_num">
					max_order_num=#max_order_num:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="max_order_num">
					worker_ext=#worker_ext:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_status">
					worker_status=#worker_status:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_name">
					opt_name=#opt_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_status">
					option_time=now()
				</isNotEmpty>
			</dynamic>
			WHERE worker_id=#worker_id:VARCHAR#
	</update>
	
	
		<!-- 更新账号信息 -->
	<update id="updateWorkerByRobotId" parameterClass="com.l9e.transaction.vo.WorkerVo">
		UPDATE cp_workerinfo
			<dynamic prepend="SET">
				<isNotEmpty prepend="," property="worker_status">
					worker_status=#worker_status:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_name">
					opt_name=#opt_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_status">
					option_time=now()
				</isNotEmpty>
			</dynamic>
			WHERE robot_id=#robot_id:VARCHAR#
	</update>
	
	
		<!-- 更新账号信息 -->
	<update id="updateRobotStatus" parameterClass="com.l9e.transaction.vo.WorkerVo">
		UPDATE cp_workerinfo
			<dynamic prepend="SET">
				<isNotEmpty prepend=" " property="worker_status">
					worker_status=#worker_status:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_name">
					opt_name=#opt_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="stop_reason">
					stop_reason=#stop_reason:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="proxy_status">
					proxy_status=#proxy_status:VARCHAR#
				</isNotEmpty>
				,option_time=now()
			</dynamic>
			where robot_id=#robot_id#  AND  
			<isNotEmpty prepend=" " property="worker_type">
					worker_type=#worker_type#
				</isNotEmpty>
			
	</update>
	
	
	<!-- 更新支付宝信息(换账号) -->
	<update id="updateRobotZfb" parameterClass="java.util.HashMap">
		UPDATE cp_cardinfo
			SET	worker_id=#workerId#
			WHERE card_no like CONCAT(#zhifubaoNew#, '%')
			AND worker_id='1000'  LIMIT 1
	</update>
	
	<!-- 更新支付宝信息 (原来账号转备用)-->
	<update id="updateRobotBfZfb" parameterClass="java.util.HashMap">
		UPDATE cp_cardinfo
			SET worker_id='1000'
			WHERE card_no= #zhifubao#	
			AND worker_id=#workerId# 
	</update>
	
	<!-- 更新短信猫口-->
	<update id="updateComNo" parameterClass="java.util.HashMap">
		UPDATE cp_cardinfo
			SET 
			<isNotEmpty prepend=" " property="com_no">
					com_no=#com_no:VARCHAR#
			</isNotEmpty>
			WHERE 
			worker_id=#worker_id# 
	</update>
	
	<!-- 查询短信猫口-->
	<select id="queryComNo" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT com_no FROM cp_cardinfo WHERE worker_id=#worker_id:VARCHAR#
	</select>
	
	<!-- 查询短信猫口数量-->
	<select id="queryComNoCount" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM cp_cardinfo WHERE com_no=#com_no:VARCHAR#
	</select>
	
		<!-- 更新账号信息 -->
	<update id="updateRobotUrl" parameterClass="com.l9e.transaction.vo.WorkerVo">
		UPDATE cp_workerinfo
			<dynamic prepend="SET">
				<isNotEmpty prepend="," property="worker_priority">
					worker_priority=#worker_priority:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="max_order_num">
					worker_ext=#worker_ext:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_name">
					opt_name=#opt_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_priority">
					worker_priority=#worker_priority:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="spare_thread">
					spare_thread=#spare_thread:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="robot_con_timeout">
					robot_con_timeout=#robot_con_timeout:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="robot_read_timeout">
					robot_read_timeout=#robot_read_timeout:VARCHAR#
				</isNotEmpty>
				,option_time=now()
			</dynamic>
			where robot_id=#robot_id#  AND  worker_name=#worker_name#  AND worker_id=#worker_id#
	</update>
	
<!-- 插入账号信息 -->
	<insert id="insertWorker" parameterClass="com.l9e.transaction.vo.WorkerVo">
		insert into cp_workerinfo
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="worker_name">
				 	worker_name
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_type">
					worker_type
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_priority">
					worker_priority
				</isNotEmpty>
				<isNotEmpty prepend="," property="order_num">
					order_num
				</isNotEmpty>
				<isNotEmpty prepend="," property="max_order_num">
					max_order_num
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_ext">
					worker_ext
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_name">
					opt_name
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_status">
					worker_status
				</isNotEmpty>
				<isNotEmpty prepend="," property="robot_id">
					robot_id
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_region">
					worker_region
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_vendor">
					worker_vendor
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_describe">
					worker_describe
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_language_type">
					worker_language_type
				</isNotEmpty>
				<isNotEmpty prepend="," property="public_ip">
					public_ip
				</isNotEmpty>
				, create_time
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="worker_name">
				 	#worker_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_type">
					#worker_type:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_priority">
					#worker_priority:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="order_num">
					#order_num:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="max_order_num">
					#max_order_num:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_ext">
					#worker_ext:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_name">
					#opt_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_status">
					#worker_status#
				</isNotEmpty>
				<isNotEmpty prepend="," property="robot_id">
					#robot_id:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_region">
					#worker_region:INTEGER#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_vendor">
					#worker_vendor:INTEGER#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_describe">
					#worker_describe:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="worker_language_type">
					#worker_language_type:VARCHAR#
				</isNotEmpty>
					<isNotEmpty prepend="," property="public_ip">
					#public_ip:VARCHAR#
				</isNotEmpty>
				,now()
			)
		</dynamic>
	</insert>

	
	<!-- 删除账号信息 -->
	<delete id="deleteWorker" parameterClass="com.l9e.transaction.vo.WorkerVo">
		delete from cp_workerinfo where worker_id=#worker_id:VARCHAR#
	</delete>
	
	<!-- 省市联动 -->
	<!-- 查询全部省信息 -->
	<select id="getProvince" resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area 
		WHERE area_rank=1 ORDER BY area_id ASC
	</select>
	
	<!-- 根据省id查询本省的所有市信息 -->
	<select id="getCity" parameterClass="java.lang.String" 
	resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area 
		WHERE area_rank=2 AND area_parentno=#provinceid# ORDER BY area_id ASC
	</select>
	
	<!-- 根据市id查询本市的所有区信息 -->
	<select id="getArea"  parameterClass="java.lang.String" 
	resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area  
		WHERE area_rank=3 AND area_parentno=#cityid# ORDER BY area_id ASC
	</select>
	
	<!-- 查询支付机器人的银行卡号的状态信息 -->
	<select id="queryWorkerCardNoAndStatus" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT card_no,card_status FROM cp_cardinfo WHERE worker_id=#worker_id:VARCHAR#
	</select>
	
	<!-- 查询支付机器人的名称信息 -->
	<select id="queryWorkerName" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT worker_name FROM cp_workerinfo WHERE worker_id=#worker_id:VARCHAR#
	</select>
	
	<!-- 切换支付机器人银行卡号的状态信息为开启状态(11等待付款22暂停付款) -->
	<update id="updateZhifuWorkerCardStatus" parameterClass="java.lang.String">
		UPDATE cp_cardinfo SET card_status='11' where card_no=#card_no#
	</update>
	
	<!-- 切换支付机器人银行卡号的状态信息为暂停状态(11等待付款22暂停付款) -->
	<update id="updateZhifuWorkerCardStatusToParse" parameterClass="java.lang.String">
		UPDATE cp_cardinfo SET card_status='22' where card_no=#card_no#
	</update>
	
	<!-- 查询正在工作中的银行卡号 -->
	<select id="queryWorkerCardNoWorking" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT card_no FROM cp_cardinfo WHERE card_status='11' AND card_no IN (SELECT card_no FROM cp_cardinfo WHERE worker_id=#worker_id:VARCHAR#)
	</select>
	
	<!-- 自动开启预定机器人 -->
	<update id="updateWorkerOpen">
		UPDATE cp_workerinfo SET worker_status='00' WHERE worker_type='1' AND worker_name NOT LIKE '%废弃%'
	</update>
	
	<!-- 自动关闭预定机器人 -->
	<update id="updateWorkerClose">
		UPDATE cp_workerinfo SET worker_status='22' WHERE worker_type='1'
	</update>
	
	<!-- 插入日志信息 -->
	<insert id="insertLog" parameterClass="java.util.HashMap">
		insert into cp_workerinfo_log
		<dynamic prepend="(">
				<isNotEmpty prepend="," property="content">
				 	content
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_person">
					opt_person
				</isNotEmpty>
					,create_time
			)
		</dynamic>
		 values
		<dynamic prepend="(">
				<isNotEmpty prepend="," property="content">
				 	#content:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="opt_person">
					#opt_person:VARCHAR#
				</isNotEmpty>
					,now()
			)
		</dynamic>
	</insert>
	
	<!-- 查询商户操作日志的总条数 -->
	<select id="queryOptionLogListCount" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM cp_workerinfo_log
	</select>
	
	<!-- 查询商户操作日志列表 -->
	<select id="queryOptionLogListList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT log_id,content,create_time,opt_person FROM cp_workerinfo_log
		ORDER BY create_time DESC
		LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
</sqlMap>