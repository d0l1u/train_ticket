<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="file">
	<!-- 将上传的文件信息插入到数据库中 -->
	<insert id="insertFile" parameterClass="java.util.HashMap">
		INSERT INTO file 
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="filename">
				 filename
			</isNotEmpty>
			<isNotEmpty prepend="," property="filepath">
				filepath
			</isNotEmpty>
			<isNotEmpty prepend="," property="bill_time">
				bill_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				create_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_name">
				opt_name
			</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="filename">
				 #filename:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="filepath">
				 #filepath:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="bill_time">
				#bill_time:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="create_time">
				NOW()
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_name">
				#opt_name:VARCHAR#
			</isNotEmpty>
			)
		</dynamic>
		<!-- 
		(filename,filepath,bill_time,create_time,opt_name)
		VALUES(#filename#,#filepath#,#bill_time#,NOW(),#opt_name#) 
		-->
	</insert>
	
	<!-- 数据库中满足查询条件的总条数 -->
	<select id="queryFileCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(id) FROM file WHERE 1=1 
		<dynamic prepend="">
	      	  <isNotEmpty prepend=" and " property="begin_info_time">
				bill_time <![CDATA[>=]]> #begin_info_time:VARCHAR#
			  </isNotEmpty>
			  <isNotEmpty prepend=" and " property="end_info_time">
				bill_time <![CDATA[<]]> DATE_ADD(#end_info_time:VARCHAR#,INTERVAL 1 DAY)
			  </isNotEmpty>
	    </dynamic>
	</select>
	
	<!-- 按照条件查询数据库中的内容，并列出 -->
	<select id="queryFileList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT id,filename,filepath,bill_time,opt_name FROM file WHERE 1=1  
		<dynamic prepend="">
	      	  <isNotEmpty prepend=" and " property="begin_info_time">
				bill_time <![CDATA[>=]]> #begin_info_time:VARCHAR#
			  </isNotEmpty>
			  <isNotEmpty prepend=" and " property="end_info_time">
				bill_time <![CDATA[<]]> DATE_ADD(#end_info_time:VARCHAR#,INTERVAL 1 DAY)
			  </isNotEmpty>
	    </dynamic>
	    ORDER BY bill_time DESC
	</select>
	
	<!-- 根据id查询文件的路径 -->
	<select id="queryFilepath" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT filepath FROM file WHERE id=#id#
	</select>
	
	<!-- 根据id删除文件信息 -->
	<delete id="deleteFile" parameterClass="java.lang.String">
		DELETE FROM file WHERE id=#id#
	</delete>
	
	
</sqlMap>