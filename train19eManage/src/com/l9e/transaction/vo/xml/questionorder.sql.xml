<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="questionorder">
<!-- 查询列表 -->
	<select id="querytrain_question_order" parameterClass="java.util.HashMap" 
	resultClass="java.util.HashMap">
		SELECT 
			question_id,
			question_seq,
			question_order_id,
			question_theme,
			question_desc,
			question_status,
			question_answer,
			DATE_FORMAT(question_answer_time,'%Y-%m-%d %H:%i:%s') AS question_answer_time,
			question_assigner,
			question_solve,
			DATE_FORMAT(question_solve_time,'%Y-%m-%d %H:%i:%s') AS question_solve_time,
			question_reply,
			question_pic 
			FROM train_question_order
			WHERE 1 = 1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="question_order_id">
				question_order_id = #question_order_id#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="begin_answer_time">
				question_answer_time<![CDATA[>=]]>#begin_answer_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_answer_time">
				question_answer_time<![CDATA[<]]>DATE_ADD(#end_answer_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="begin_solve_time">
				question_solve_time<![CDATA[>=]]>#begin_solve_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_solve_time">
				question_solve_time<![CDATA[<]]>DATE_ADD(#end_solve_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="question_answer">
				question_answer = #question_answer#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="question_solve">
				question_solve = #question_solve#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="question_assigner">
				question_assigner = #question_assigner#
			</isNotEmpty>
			 <isNotEmpty prepend=" and " property="question_status">
	         	  question_status in
		          <iterate open="(" close=")" conjunction="," property="question_status">
		            	#question_status[]:VARCHAR#
		      	  </iterate>
	      	  </isNotEmpty>
		</dynamic>
		ORDER BY question_answer_time DESC 
		 LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	<!-- 查询列表总数 -->
	<select id="querytrain_question_orderCount" parameterClass="java.util.HashMap" 
	resultClass="java.lang.Integer">
	 SELECT 
		     COUNT(question_id)
		  FROM
		    train_question_order  
		  WHERE 1 = 1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="question_order_id">
				question_order_id = #question_order_id#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="begin_answer_time">
				question_answer_time<![CDATA[>=]]>#begin_answer_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_answer_time">
				question_answer_time<![CDATA[<]]>DATE_ADD(#end_answer_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="begin_solve_time">
				question_solve_time<![CDATA[>=]]>#begin_solve_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_solve_time">
				question_solve_time<![CDATA[<]]>DATE_ADD(#end_solve_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="question_answer">
				question_answer = #question_answer#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="question_solve">
				question_solve = #question_solve#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="question_assigner">
				question_assigner = #question_assigner#
			</isNotEmpty>
			 <isNotEmpty prepend=" and " property="question_status">
	         	  question_status in
		          <iterate open="(" close=")" conjunction="," property="question_status">
		            	#question_status[]:VARCHAR#
		      	  </iterate>
	      	  </isNotEmpty>
		</dynamic>
		ORDER BY question_answer_time DESC 
	</select>
	
	<!-- 修改 -->
	<update id="updatetrain_question_order" parameterClass="java.util.HashMap">
		update train_question_order 
		<dynamic prepend="set">
			<isNotEmpty prepend=","  property="question_order_id">
				 question_order_id=#question_order_id#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_theme">
				 question_theme=#question_theme#
			</isNotEmpty>
			<isNotEmpty prepend=","  property="question_desc">
				 question_desc=#question_desc#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_status">
				 question_status=#question_status#
			</isNotEmpty>
			<isNotEmpty prepend=","  property="question_assigner">
				 question_assigner=#question_assigner#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_solve">
				 question_solve=#question_solve#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_solve_time">
				 question_solve_time=now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_pic">
				 question_pic=#question_pic#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_reply">
				 question_reply=#question_reply#
			</isNotEmpty>
		</dynamic>
		where question_id=#question_id#
	</update>
	
	<!-- 增加返回日志 -->
	<insert id="addtrain_question_order" parameterClass="java.util.HashMap">
		INSERT INTO train_question_order
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="question_order_id">
				 question_order_id
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_seq">
				 question_seq
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_theme">
				 question_theme
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_desc">
				 question_desc
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_status">
				 question_status
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_answer">
				 question_answer
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_answer_time">
				 question_answer_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_assigner">
				 question_assigner
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_pic">
				 question_pic
			</isNotEmpty>
	
			)
		</dynamic>
		values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="question_order_id">
				 #question_order_id#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_seq">
				 #question_seq#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_theme">
				 #question_theme#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_desc">
				 #question_desc#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_status">
				 '11'
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_answer">
				 #question_answer#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_answer_time">
				 now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_assigner">
				 #question_assigner#
			</isNotEmpty>
			<isNotEmpty prepend="," property="question_pic">
				 #question_pic#
			</isNotEmpty>
			
			)
		</dynamic>
	</insert>
	
	<!-- 删除 -->
	<delete id="deletetrain_question_order" parameterClass="java.util.HashMap">
		delete from train_question_order 
		where question_id=#question_id#
	</delete>
	
	<!-- 增加操作日志 -->
	<insert id="addLog" parameterClass="java.util.HashMap">
		insert into train_question_order_log (
			content,create_time, opt_person,question_seq)
		value(#content#,NOW(),#opt_person#,#question_seq#)
	</insert>
	
	<!-- 问题订单详情 -->
	<select id="getquestionOrderInfo" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT 
			question_id,
			question_seq,
			question_order_id,
			question_theme,
			question_desc,
			question_status,
			question_answer,
			DATE_FORMAT(question_answer_time,'%Y-%m-%d %H:%i:%s') AS question_answer_time,
			question_assigner,
			question_solve,
			DATE_FORMAT(question_solve_time,'%Y-%m-%d %H:%i:%s') AS question_solve_time,
			question_reply,
			question_pic 
			FROM train_question_order
			WHERE question_id=#question_id#
	</select>
	
	<!-- 查询操作日志 -->
	<select id="queryHistroyByQuestion_id" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT 
			log_id,
			content,
			DATE_FORMAT(create_time,'%Y-%m-%d %H:%i:%s') AS create_time,
			opt_person
			FROM train_question_order_log
			WHERE question_seq=#question_seq#
	</select>
</sqlMap>