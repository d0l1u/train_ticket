<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="appNotice">

	<!-- 查询账号条数 -->
	<select id="queryNoticeListCount" parameterClass="java.util.HashMap"
		resultClass="java.lang.Integer">
		SELECT COUNT(1) 
				FROM app_noticeinfo a
				WHERE 1=1	
	        ORDER BY a.create_time DESC
		
	</select>
	
	<!-- 查询账号信息 -->
	<select id="queryNoticeList" parameterClass="java.util.HashMap"
		resultClass="java.util.HashMap">
		SELECT a.notice_id, a.notice_name, a.notice_status, a.notice_content, a.notice_system,
			DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time,a.opt_ren
			FROM app_noticeinfo a
			WHERE 1=1
	    ORDER BY a.create_time DESC
        LIMIT #everyPagefrom:Integer#, #pageSize:Integer#
	</select>
	
	<!-- 查询账号明细信息 -->
	<select id="queryNotice" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT a.notice_id, a.notice_name, 
			a.notice_status, a.notice_content, a.notice_system,
			DATE_FORMAT(a.create_time,'%Y-%m-%d %H:%i:%s') AS create_time
		FROM app_noticeinfo a
			WHERE a.notice_id=#notice_id:VARCHAR# 
	</select>
	
	
	<!-- 更新账号信息 -->
	<update id="updateNotice" parameterClass="com.l9e.transaction.vo.AppNoticeVo">
		UPDATE app_noticeinfo
			<dynamic prepend="SET">
				<isNotEmpty prepend="," property="notice_content">
				 	notice_content=#notice_content:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="notice_name">
					notice_name=#notice_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="notice_status">
					notice_status=#notice_status:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="notice_system">
					notice_system=#notice_system:VARCHAR#
				</isNotEmpty>
				<!-- <isNotEmpty prepend="," property="provinces">
					provinces=#provinces:VARCHAR#
				</isNotEmpty>    
				<isNotEmpty prepend="," property="pub_time">
					pub_time=#pub_time:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="stop_time">
					stop_time=#stop_time:VARCHAR#
				</isNotEmpty>-->
				<isNotEmpty prepend="," property="opt_ren">
					opt_ren=#opt_ren:VARCHAR#
				</isNotEmpty>
			</dynamic>
			WHERE notice_id=#notice_id:VARCHAR#
	</update>
	
	<!-- 插入账号信息 -->
	<insert id="insertNotice" parameterClass="com.l9e.transaction.vo.AppNoticeVo">
		insert into app_noticeinfo
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="notice_content">
				notice_content
			</isNotEmpty>
			<isNotEmpty prepend="," property="notice_name">
				notice_name
			</isNotEmpty>
			<isNotEmpty prepend="," property="notice_status">
				notice_status
			</isNotEmpty>
			<isNotEmpty prepend="," property="notice_system">
				notice_system
			</isNotEmpty>
		<!-- 	<isNotEmpty prepend="," property="provinces">
				provinces
			</isNotEmpty>   
			<isNotEmpty prepend="," property="pub_time">
				pub_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="stop_time">
				stop_time
			</isNotEmpty> -->
			<isNotEmpty prepend="," property="notice_name">
				create_time
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				opt_ren
			</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="notice_content">
				 #notice_content:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="notice_name">
				 #notice_name:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="notice_status">
				#notice_status:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="notice_system">
				#notice_system:VARCHAR#
			</isNotEmpty>
			<!-- <isNotEmpty prepend="," property="provinces">
				#provinces#
			</isNotEmpty>  
			<isNotEmpty prepend="," property="pub_time">
				#pub_time:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="stop_time">
				#stop_time:VARCHAR#
			</isNotEmpty> -->
			<isNotEmpty prepend="," property="notice_name">
				now()
			</isNotEmpty>
			<isNotEmpty prepend="," property="opt_ren">
				#opt_ren:VARCHAR#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 插入指定电话发布的信息app_notice_userinfo -->
	<insert id="addNoticeUser" parameterClass="java.util.HashMap">
		insert into app_notice_userinfo
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="notice_id">
				notice_id
			</isNotEmpty>
			<isNotEmpty prepend="," property="user_phone">
				user_phone
			</isNotEmpty>
			<isNotEmpty prepend="," property="status">
				status
			</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="notice_id">
				 #notice_id:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="user_phone">
				 #user_phone:VARCHAR#
			</isNotEmpty>
			<isNotEmpty prepend="," property="status">
				 #status:VARCHAR#
			</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 删除账号信息 -->
	<delete id="deleteNotice" parameterClass="com.l9e.transaction.vo.AppNoticeVo">
		delete from app_noticeinfo where notice_id=#notice_id:VARCHAR#
	</delete>
	
	<!-- 省市联动 -->
	
	<select id="getProvince" resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area 
		WHERE area_rank=1 ORDER BY area_id ASC
	</select>
	
	<select id="getCity" parameterClass="java.lang.String" 
	resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area 
		WHERE area_rank=2 AND area_parentno=#provinceid# ORDER BY area_id ASC
	</select>
	
	<select id="getArea"  parameterClass="java.lang.String" 
	resultClass="com.l9e.transaction.vo.AreaVo">
		SELECT area_no, area_name FROM gen_area  
		WHERE area_rank=3 AND area_parentno=#cityid# ORDER BY area_id ASC
	</select>
	
	<select id="queryNoticeId" parameterClass="com.l9e.transaction.vo.AppNoticeVo" 
		resultClass="java.lang.String">
		SELECT notice_id FROM app_noticeinfo 
		WHERE DATE_FORMAT(create_time,'%Y-%m-%d') = DATE_FORMAT(NOW(),'%Y-%m-%d')
			AND notice_name=#notice_name# 
			AND notice_content=#notice_content# 
			AND notice_system=#notice_system# 
	</select>
	
	<select id="queryUserPhone" parameterClass="java.lang.String" 
		resultClass="java.lang.String">
		SELECT user_phone FROM app_notice_userinfo WHERE notice_id=#notice_id#
	</select>
</sqlMap>