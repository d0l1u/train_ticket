<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="login">
	<!-- 查询数据库user信息 -->
	<select id="queryLogin_UserInfo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT user_id,username,pwd,real_name,login_status,code_total_number,code_error_number,last_login_time,
		department,telephone,email,user_level,logined FROM rh_user WHERE username=#username# AND pwd=#pwd#
	</select>
	
	<!-- 查询用户当月打码成功金额 -->
	<select id="queryAdminCodeMonthMoney" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT IFNULL(SUM(pic_success),0)pic_success
		FROM tj_rh_picture WHERE DATE_FORMAT(opt_time,'%Y-%m')=DATE_FORMAT(NOW(),'%Y-%m') AND opt_ren=#opt_ren#
	</select>
	
	<!-- 查询用户列表条数 -->
	<select id="queryLoginUserListCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1)FROM(
		SELECT user_id,username,pwd,real_name,login_status,code_total_number,code_error_number,last_login_time,
		department,telephone,email,user_level FROM rh_user WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="username">
					username=#username#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="user_id">
					user_id=#user_id#
			</isNotEmpty>
		</dynamic>
		)AS temp
	</select>
	
	<!-- 添加账号 -->
	<insert id="addAdmin" parameterClass="java.util.HashMap">
		insert into rh_user
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="username">
				 	username
				</isNotEmpty>
				<isNotEmpty prepend="," property="pwd">
					pwd
				</isNotEmpty>
				<isNotEmpty prepend="," property="real_name">
					real_name
				</isNotEmpty>
				<isNotEmpty prepend="," property="department">
					department
				</isNotEmpty>
				<isNotEmpty prepend="," property="email">
					email
				</isNotEmpty>
				<isNotEmpty prepend="," property="telephone">
					telephone
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_level">
					user_level
				</isNotEmpty>
			)
		</dynamic>
		 values
		<dynamic prepend="(">
			<isNotEmpty prepend="," property="username">
				 	#username:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="pwd">
					#pwd:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="real_name">
					#real_name:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="department">
					#department:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="email">
					#email:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="telephone">
					#telephone:VARCHAR#
				</isNotEmpty>
				<isNotEmpty prepend="," property="user_level">
					#user_level:VARCHAR#
				</isNotEmpty>
			)
		</dynamic>
	</insert>
	
	<!-- 修改用户的登录状态，登录过状态为1，默认为0 -->
	<update id="updateLoginTimeAndIp" parameterClass="java.util.HashMap">
		UPDATE rh_user SET logined='1' WHERE user_id=#user_id#
	</update>
	
	<!-- 查询当天打码总数信息 -->
	<select id="queryCodeCountToday" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') 
		AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	
	<!-- 查询当天打码正确1总数信息 -->
	<select id="queryCodeToday" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') 
		AND result_status='1' AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	<!-- 查询当天打码错误0总数信息 -->
	<select id="queryCodeFailToday" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') 
		AND result_status='0' AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	<!-- 查询当天打码超时5总数信息 -->
	<select id="queryCodeOvertimeToday" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') 
		AND result_status='5' AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	<!-- 查询本周打码总数信息,每周一为一周的第一天 -->
	<select id="queryCodeCountWeek" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE YEARWEEK(DATE_FORMAT(opt_time,'%Y-%m-%d'),1) = YEARWEEK(NOW(),1) AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	
	<!-- 查询本周打码正确1，错误0，超时5总数信息 -->
	<select id="queryCodeWeek" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
		SELECT IFNULL(SUM(pic_success),0) FROM tj_rh_picture WHERE YEARWEEK(DATE_FORMAT(opt_time,'%Y-%m-%d')) = YEARWEEK(NOW())
	</select>
	
	<!-- 查询昨日打码情况 -->
	<select id="queryCodeCountYesterday" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE DATE_FORMAT(opt_time,'%Y-%m-%d') = DATE_SUB(DATE_FORMAT(NOW(),'%Y-%m-%d'),INTERVAL 1 DAY) AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	
	<!-- 查询本月打码总数信息 -->
	<select id="queryCodeCountMonth" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m')=DATE_FORMAT(NOW(),'%Y-%m') AND opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	
	<!-- 查询本月打码正确1，错误0，超时5总数信息 -->
	<select id="queryCodeMonth" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m')=DATE_FORMAT(NOW(),'%Y-%m') AND result_status=#i#
	</select>
	
	<!-- 查询打码总数信息 -->
	<select id="queryCodeCount" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0) pic_count,IFNULL(SUM(pic_success),0) pic_success,
		IFNULL(SUM(pic_fail),0) pic_fail,IFNULL(SUM(pic_unkonwn),0) pic_unkonwn 
		FROM tj_rh_picture WHERE opt_ren IN (SELECT username FROM rh_user 
		WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		)
	</select>
	
	<!-- 查询打码正确1，错误0，超时5总数信息 -->
	<select id="queryCode" parameterClass="java.lang.Integer" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE result_status=#i#
	</select>
	
	<!-- 验证账号是否存在 -->
	<select id="queryUsername" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT username FROM rh_user WHERE username=#user_name#
	</select>
	<!-- 验证真实姓名是否重复 -->
	<select id="queryRealname" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_user WHERE real_name=#real_name#
	</select>
	
	<!-- 查询时间 -->
	<select id="queryDate_List" resultClass="java.lang.String">
		SELECT DISTINCT DATE_FORMAT(create_time, '%Y-%m-%d') AS create_time 
		FROM rh_picture 
		WHERE create_time IS NOT NULL 
		ORDER BY DATE_FORMAT(create_time, '%Y-%m-%d') ASC 
	</select>
	<!-- 按天查询数据的条数 -->
	<select id="queryDayPageCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer" >
		SELECT COUNT(1) FROM (SELECT DISTINCT opt_time FROM tj_rh_picture 
		WHERE 1=1
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				opt_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				opt_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	        	channel in
		    	<iterate open="(" close=")" conjunction="," property="channel">
		        	#channel[]:VARCHAR#
		    	</iterate>
	      	</isNotEmpty>
	    </dynamic>
		)AS temp
	</select>
	
	<!-- 查询某天打码总数信息 -->
	<select id="queryCodeCountDay" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(#create_time#,'%Y-%m-%d')
	</select>
	
	<!-- 查询某天打码正确1，错误0，超时5总数信息 -->
	<select id="queryCodeDay" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(#create_time#,'%Y-%m-%d') AND result_status=#i#
	</select>
	
	<!-- 查询某天打码总数,打码正确1，错误0，超时5总数信息 -->
	<select id="queryDayPageList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT opt_time,IFNULL(SUM(pic_count),0) pic_count,IFNULL(SUM(pic_success),0) pic_success,
		IFNULL(SUM(pic_fail),0) pic_fail,IFNULL(SUM(pic_unkonwn),0) pic_unkonwn, channel, DATE_FORMAT(opt_time, '%d') opt_day 
		FROM tj_rh_picture 
		where 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="begin_time">
				opt_time<![CDATA[>=]]>
				#begin_time#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="end_time">
				opt_time<![CDATA[<]]>DATE_ADD(#end_time:VARCHAR#,INTERVAL 1 DAY)
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="channel">
	        	channel in
		    	<iterate open="(" close=")" conjunction="," property="channel">
		        	#channel[]:VARCHAR#
		    	</iterate>
	      	</isNotEmpty>
	    </dynamic>
		GROUP BY opt_time,channel ORDER BY opt_time DESC LIMIT #everyPagefrom:Integer#,#pageSize:Integer#	
	</select>
	
	<!-- 按用户查询数据的条数 -->
	<select id="queryByAdminPageCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer" >
		SELECT COUNT(1) FROM (SELECT DISTINCT t.opt_ren FROM tj_rh_picture t LEFT JOIN rh_user r ON t.opt_ren=r.username where 1=1 
			<dynamic prepend="and ">
				<isNotEmpty prepend=" and " property="opt_ren">
					t.opt_ren=#opt_ren#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="opt_name">
					t.opt_name=#opt_name#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="department">
					r.department=#department#
				</isNotEmpty>
		    </dynamic>
		)AS temp
	</select>
	<!-- 查询管理员打码总数,打码正确1，错误0，超时5总数信息 -->
	<select id="queryAdminCodeList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT  * FROM
		(SELECT j.opt_ren ren,ROUND((IFNULL(SUM(j.pic_success),0) / 100),2) successPreCount FROM tj_rh_picture  j
		WHERE DATE_FORMAT(j.opt_time,'%Y-%m')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 MONTH),'%Y-%m') GROUP BY opt_ren ) AS a
		LEFT JOIN	
		(SELECT t.opt_ren,t.opt_name,r.department,IFNULL(SUM(t.pic_count),0) pic_count,
		IFNULL(SUM(t.pic_success),0) pic_success,IFNULL(SUM(t.pic_fail),0) pic_fail,IFNULL(SUM(t.pic_unkonwn),0) pic_unkonwn 
		FROM tj_rh_picture t LEFT JOIN rh_user r ON t.opt_ren=r.username WHERE 1=1 GROUP BY opt_ren) AS b
		ON a.ren=b.opt_ren where 1=1 
		<dynamic prepend="and ">
			<isNotEmpty prepend=" and " property="opt_ren">
				b.opt_ren=#opt_ren#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="opt_name">
				b.opt_name=#opt_name#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="department">
				b.department=#department#
			</isNotEmpty>
	    </dynamic>
		ORDER BY b.pic_success DESC LIMIT #everyPagefrom:Integer#,#pageSize:Integer#	
	</select>
	
	<!-- 查询用户当天的打码总数 -->
	<select id="queryAdminCodeTodayCount" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') AND opt_ren=#opt_ren#
	</select>
	<!-- 查询用户当天的打码失败总数 -->
	<select id="queryAdminCodeTodayFail" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') AND opt_ren=#opt_ren# AND result_status='0'
	</select>
	<!-- 查询用户当天的打码成功总数 -->
	<select id="queryAdminCodeTodaySuccess" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') AND opt_ren=#opt_ren# AND result_status='1'
	</select>
	<!-- 查询用户当天的打码超时总数 -->
	<select id="queryAdminCodeTodayOvertime" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') AND opt_ren=#opt_ren# AND result_status='5'
	</select>
	
	
	<!-- 查询用户当月的打码情况 -->
	<select id="queryAdminCodeMonth" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE DATE_FORMAT(opt_time,'%Y-%m')=DATE_FORMAT(NOW(),'%Y-%m') AND opt_ren=#opt_ren#
	</select>
	
	<!-- 查询用户本周打码情况 -->
	<select id="queryAdminCodeWeek" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE YEARWEEK(DATE_FORMAT(opt_time,'%Y-%m-%d'),1) = YEARWEEK(NOW(),1) AND opt_ren=#opt_ren#
	</select>
	
	<!-- 查询用户昨日打码情况 -->
	<select id="queryAdminCodeYesterday" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE DATE_FORMAT(opt_time,'%Y-%m-%d')=DATE_SUB(CURDATE(),INTERVAL 1 DAY) AND opt_ren=#opt_ren#
	</select>
	
	<!-- 查询用户打码情况 -->
	<select id="queryAdminCodeInfoSum" parameterClass="java.lang.String" resultClass="java.util.HashMap">
		SELECT IFNULL(SUM(pic_count),0)pic_count,IFNULL(SUM(pic_success),0)pic_success,IFNULL(SUM(pic_fail),0)pic_fail,IFNULL(SUM(pic_unkonwn),0)pic_unkonwn 
		FROM tj_rh_picture WHERE opt_ren=#opt_ren#
	</select>
	
	<!-- 查询当前在线的用户的打码情况 -->
	<select id="queryAdminCurrentName" resultClass="java.util.HashMap">
		SELECT username,real_name,get_code_time_limit FROM rh_user WHERE login_status='1' AND last_login_time like CONCAT(#last_login_time#,'%')  
		<isNotEmpty prepend=" and " property="department">
			department=#department#
		</isNotEmpty>
		order by username LIMIT #everyPagefrom:Integer#,#pageSize:Integer#	
	</select>
	
	<!-- 查询某用户当天的打码总数 -->
	<select id="queryAdminCodeCurrentCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE DATE_FORMAT(create_time,'%Y-%m-%d')=DATE_FORMAT(NOW(),'%Y-%m-%d') AND opt_ren=#opt_ren# 
		LIMIT #everyPagefrom:Integer#,#pageSize:Integer#	
	</select>
	
	<!-- 查询某用户当天的打码总条数 -->
	<select id="queryAdminCurrentNameCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM (SELECT username,real_name FROM rh_user WHERE login_status='1'  AND DATE_FORMAT(last_login_time,'%Y-%m-%d')=DATE_FORMAT(CURDATE(),'%Y-%m-%d')  
		<dynamic prepend="and ">
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
			<isEqual compareValue="99" property="department">
				and department NOT IN ('4','5','00')
			</isEqual>
	    </dynamic>
		) AS temp
	</select>
	
	<!-- 查询某用户所属部门 -->
	<select id="queryAdminDepartment" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT department FROM rh_user WHERE username=#username#
	</select>
	
	<!-- 查询操作人真实姓名-->
	<select id="queryOptname" parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT DISTINCT real_name FROM rh_user WHERE username=#opt_ren# 
	</select>
	
	<!-- 超级管理员删除用户的账号信息 -->
	<delete id="deleteAdmin" parameterClass="java.lang.String">
		DELETE FROM rh_user WHERE username=#username#
	</delete>
	
	<!-- 查询所有的用户信息 -->
	<select id="queryAdminUserList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT user_id,username,real_name,login_status,last_login_time,department,telephone,email,user_level,get_code_time_limit 
		FROM rh_user WHERE 1=1 
		<dynamic prepend="and ">
			<isNotEmpty prepend=" and " property="username">
				username=#username#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="real_name">
				real_name=#real_name#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="department">
				department=#department#
			</isNotEmpty>
	    </dynamic>
		ORDER BY username LIMIT #everyPagefrom:Integer#,#pageSize:Integer#	
	</select>
	
	<!-- 查询所有用户的数量 -->
	<select id="queryByAdminUserListPageCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(user_id) FROM rh_user WHERE 1=1 
			<dynamic prepend="and ">
				<isNotEmpty prepend=" and " property="username">
					username=#username#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="real_name">
					real_name=#real_name#
				</isNotEmpty>
				<isNotEmpty prepend=" and " property="department">
					department=#department#
				</isNotEmpty>
		    </dynamic>
	</select>
	
	<!-- 查询用户上个月的打码收入 -->
	<select id="querySuccessPreCount" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT IFNULL(SUM(pic_success),0) successPreCount FROM tj_rh_picture  
		WHERE DATE_FORMAT(opt_time,'%Y-%m')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 MONTH),'%Y-%m')
		AND opt_ren=#opt_ren#
	</select>
	
	
	<!-- 查询未打码总数 -->
	<select id="queryWaitCodeCount" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE status='00' AND effect_time>NOW()
	</select>
	
	
	
	<!-- 查询打码效率条数 -->
	<select id="queryCodeRateCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM tj_code_rate WHERE 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="day_stat">
					day_stat=#day_stat#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="hour_stat">
					hour_stat=#hour_stat#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="username">
					username=#username#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="department">
					department=#department#
			</isNotEmpty>
		</dynamic>
	</select>
	
	<!-- 查询打码效率详细信息 -->
	<select id="queryCodeRateList" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT id, day_stat, hour_stat, username, code_success, code_fail, code_over, code_count, 
		code_get_time, code_time, code_success_rate, department, create_time 
		FROM tj_code_rate
		where 1=1 
		<dynamic prepend="">
			<isNotEmpty prepend=" and " property="day_stat">
					day_stat=#day_stat#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="hour_stat">
					hour_stat=#hour_stat#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="username">
					username=#username#
			</isNotEmpty>
			<isNotEmpty prepend=" and " property="department">
					department=#department#
			</isNotEmpty>
		</dynamic>
		ORDER BY day_stat DESC, hour_stat DESC, code_time ASC LIMIT #everyPagefrom:Integer#,#pageSize:Integer#	
	</select>
	
	<!-- 查询用户当月打码成功金额 -->
	<select id="querySystemInfo" resultClass="java.util.HashMap">
		SELECT CONVERT(code01_weight, CHAR) code01_weight, CONVERT(code02_weight, CHAR) code02_weight, 
		CONVERT(code03_weight, CHAR) code03_weight, CONVERT(code04_weight, CHAR) code04_weight
		FROM rh_system
	</select>
	
	<!-- 修改用户的登录状态，登录过状态为1，默认为0 -->
	<update id="updateSystemInfo" parameterClass="java.util.HashMap">
		UPDATE rh_system SET 
		<isNotEmpty property="code01_weight">
			code01_weight = #code01_weight#
		</isNotEmpty> 
		<isNotEmpty property="code02_weight">
			,code02_weight = #code02_weight#
		</isNotEmpty> 
		<isNotEmpty property="code03_weight">
			,code03_weight = #code03_weight#
		</isNotEmpty> 
		<isNotEmpty property="code04_weight">
			,code04_weight = #code04_weight#
		</isNotEmpty> 
	</update>
	
	<!-- 查询各个部门的未打码总数 -->
	<select id="queryWaitCodeQueenCount" parameterClass="java.lang.String" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM rh_picture WHERE STATUS='00' AND effect_time>NOW() AND channel='19e' AND department=#department#
	</select>
	
	<!-- 查询某用户当天的打码总条数 -->
	<select id="queryAdminCurrentOtherCount" parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM (SELECT username,real_name FROM rh_user WHERE login_status='1'  
		AND DATE_FORMAT(last_login_time,'%Y-%m-%d')=DATE_FORMAT(CURDATE(),'%Y-%m-%d')  
		<dynamic prepend="and ">
			<isNotEmpty prepend=" and " property="department">
				department NOT IN ('4','5','00')
			</isNotEmpty>
	    </dynamic>
		) AS temp
	</select>
	
</sqlMap>