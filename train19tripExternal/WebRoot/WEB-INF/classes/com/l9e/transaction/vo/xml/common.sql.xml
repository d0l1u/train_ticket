<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="common">

	<!-- 查询对外产品信息 -->
	<select id="queryForeignProductInfo" parameterClass="com.l9e.transaction.vo.ExternalProductVo"
		resultClass="com.l9e.transaction.vo.ExternalProductVo">
		SELECT p.product_id,p.type,p.name,p.sale_price,p.describe,p.level
			FROM hc_productinfo p
			WHERE 1=1
		<isNotEmpty prepend=" and " property="type">
			p.type=#type:INTEGER#
		</isNotEmpty>
			and p.status=1
		<isNotEmpty prepend=" and " property="product_id">
			p.product_id=#product_id:VARCHAR#
		</isNotEmpty>
		order by p.product_id
	</select>
	
	<!-- 查询系统接口频道  -->
	<select id="queryInterfaceChannel" resultClass="java.lang.String">
		SELECT s.setting_value FROM ext_system_setting s 
		WHERE s.setting_name='INTERFACE_CHANNEL'
	</select>
	
	<!-- 查询系统配置的12306接口url -->
	<select id="querySysInterfaceUrl" resultClass="java.lang.String">
		SELECT setting_value FROM ext_system_setting 
		WHERE setting_name='INTERFACE_12306_URL' AND setting_status='1' 
	</select>
	
	<!-- 查询获取系统设置属性值 -->
	<select id="querySysSettingValue" parameterClass="java.util.HashMap"
		resultClass="java.lang.String">
		SELECT setting_value FROM ext_system_setting 
		 WHERE setting_name=#setting_name:VARCHAR#
		 <isNotEmpty prepend=" and " property="setting_status">
		 	setting_status=#setting_status:VARCHAR#
		 </isNotEmpty>
	</select>
	
	<!-- 根据key查询系统设置 -->
	<select id="querySysSettingByKey" parameterClass="java.lang.String"
		resultClass="java.lang.String">
		SELECT setting_value FROM ext_system_setting 
		WHERE setting_name=#key:VARCHAR#
	</select>
	
	<!-- 根据key查询系统设置 -->
	<select id="getTrainSysSettingValue" parameterClass="java.lang.String"
		resultClass="java.lang.String">
		SELECT setting_value FROM train_system_setting 
		WHERE setting_name=#key:VARCHAR# AND setting_status = '1'
	</select>
	
	<!-- 根据合作商户编号查询商户配置信息-->
	<select id="queryMerchantInfo" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
		SELECT merchant_id,merchant_name,sign_key,pay_order_fee,pay_type,
		bx_10_fee,bx_20_fee,bx_company,sms_channel,stop_buyTicket_time,
		spare_ticket_amount,merchant_status,agent_id,agent_name,verify_status,
		CONVERT(book_limit_time,CHAR) book_limit_time,mid_pay,book_flow,
		CONVERT(ticket_num,CHAR) ticket_num      
		FROM ext_merchantinfo 
		WHERE merchant_id=#merchant_id:VARCHAR#
	</select>
	
	<!-- 根据合作商户编号查询商户配置信息-->
	<update id="updateMerchantStatus" parameterClass="java.util.HashMap">
		UPDATE ext_merchantinfo SET merchant_status = #merchant_status:VARCHAR# 
		WHERE merchant_id=#merchant_id:VARCHAR#
	</update>
	
	<!-- 根据合作商户编号查询商户配置信息-->
	<update id="updateMerchantVerifyNum" parameterClass="java.lang.String">
		UPDATE ext_merchantinfo SET verify_total_num =verify_total_num+1 
		WHERE merchant_id=#merchant_id:VARCHAR#
	</update>
	<!-- 查询车次对应的票价 -->
	<select id="queryCheciPrice" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		SELECT
		CONVERT(wz,CHAR) as wz,
		CONVERT(yz,CHAR) as yz,
		CONVERT(rz,CHAR) as rz,
		CONVERT(yws,CHAR) as yws,
		CONVERT(ywz,CHAR) as ywz,
		CONVERT(ywx,CHAR) as ywx,
		CONVERT(rws,CHAR) as rws,
		CONVERT(rwx,CHAR) as rwx,
		CONVERT(rz2,CHAR) as rz2,
		CONVERT(rz1,CHAR) as rz1,
		CONVERT(swz,CHAR) as swz,
		CONVERT(tdz,CHAR) as tdz,
		CONVERT(gws,CHAR) as gws,
		CONVERT(gwx,CHAR) as gwx,
		CONVERT(dws,CHAR) as dws,
		CONVERT(dwx,CHAR) as dwx
		FROM   t_zjpj_a  
		WHERE  cc =#train_code:VARCHAR#  AND  fz=#from_station:VARCHAR#  AND  dz=#arrive_station:VARCHAR#  LIMIT 1
	</select>
	
</sqlMap>